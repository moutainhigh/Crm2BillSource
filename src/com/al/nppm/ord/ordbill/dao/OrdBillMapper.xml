<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.al.nppm.ord.ordbill.dao.OrdBillMapper" >
<!--   <resultMap id="BaseResultMap" type="com.al.nppm.model.ord_bill" > -->
<!--     <result column="ARCH_GRP_ID" property="archGrpId" jdbcType="BIGINT" /> -->
<!--     <result column="CUST_ORDER_ID" property="custOrderId" jdbcType="BIGINT" /> -->
<!--     <result column="REGION_ID" property="regionId" jdbcType="BIGINT" /> -->
<!--     <result column="CREATE_ORG_ID" property="createOrgId" jdbcType="BIGINT" /> -->
<!--     <result column="CREATE_STAFF" property="createStaff" jdbcType="BIGINT" /> -->
<!--     <result column="CREATE_DATE" property="createDate" jdbcType="DATE" /> -->
<!--     <result column="FINISH_DATE" property="finishDate" jdbcType="DATE" /> -->
<!--     <result column="PROC_FLAG" property="procFlag" jdbcType="VARCHAR" /> -->
<!--     <result column="PROC_DATE" property="procDate" jdbcType="DATE" /> -->
<!--     <result column="PROC_CNT" property="procCnt" jdbcType="BIGINT" /> -->
<!--     <result column="NOTES" property="notes" jdbcType="VARCHAR" /> -->
<!--   </resultMap> -->


<select id="selectOrdProdInstByRoute" resultType="java.util.Map" parameterType="map">
    SELECT 
    ARCH_GRP_ID, ORDER_ITEM_ID, PROD_INST_ID prodInstId, PROD_ID prodId, ACC_PROD_INST_ID accProdInstId, PROD_USE_TYPE prodUseType, 
    ACC_NUM accNum, ACCOUNT account, PAYMENT_MODE_CD paymentModeCd, ADDRESS_DESC addressDesc, OWNER_CUST_ID ownerCustId, PROD_INST_PWD prodInstPwd, EXCH_ID exchId, 
    ADDRESS_ID addressId, REGION_ID regionId, LAN_ID lanId, ACT_DATE actDate, BEGIN_RENT_DATE beginRentDate, STOP_RENT_DATE stopRentDate, CREATE_ORG_ID createOrgId, 
    FIRST_FINISH_DATE firstFinishDate, BUSI_MOD_DATE busiModDate, USE_CUST_ID useCustId, ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType, STATUS_CD statusCd, 
    STATUS_DATE statusDate, CREATE_STAFF createStaff, CREATE_DATE createDate, UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark, PROD_FUNC_TYPE prodFuncType, 
    RECORD_STATUS_CD recordStatusCd, VER_NUM verNum, EXT_PROD_INST_ID extProdInstId, POINT_OWNER_ID pointOwnerId, OWNER_CUST_NAME ownerCustName, USE_CUST_NAME useCustName, 
    POINT_OWNER_NAME pointOwnerName, ACC_PROD_ID accProdId, ACC_PROD_NAME accProdName, OUTER_PROD_INST_ID outerProdInstId, CDMA_IMSI cdmaImsi, GSM_IMSI gsmImsi, 
    LTE_IMSI lteImsi
    FROM ORD_PROD_INST
     WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
     AND PROD_USE_TYPE = 1000
     AND PROD_INST_ID = #{prodInstId,jdbcType=BIGINT}
     
     <choose>
		<when test="oper_type != null and  oper_type !='' ">
			AND OPER_TYPE = #{oper_type}
		</when>
		<otherwise>
			AND OPER_TYPE = 1000
		</otherwise>
	</choose>
     
</select>

<select id="selectOrdProdInstAttr1000" resultType="java.util.Map" parameterType="map">
    SELECT 
    ARCH_GRP_ID, ORDER_ITEM_ID, PROD_INST_ID prodInstId, PROD_ID prodId, ACC_PROD_INST_ID accProdInstId, PROD_USE_TYPE prodUseType, 
    ACC_NUM accNum, ACCOUNT account, PAYMENT_MODE_CD paymentModeCd, ADDRESS_DESC addressDesc, OWNER_CUST_ID ownerCustId, PROD_INST_PWD prodInstPwd, EXCH_ID exchId, 
    ADDRESS_ID addressId, REGION_ID regionId, LAN_ID lanId, ACT_DATE actDate, BEGIN_RENT_DATE beginRentDate, STOP_RENT_DATE stopRentDate, CREATE_ORG_ID createOrgId, 
    FIRST_FINISH_DATE firstFinishDate, BUSI_MOD_DATE busiModDate, USE_CUST_ID useCustId, ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType, STATUS_CD statusCd, 
    STATUS_DATE statusDate, CREATE_STAFF createStaff, CREATE_DATE createDate, UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark, PROD_FUNC_TYPE prodFuncType, 
    RECORD_STATUS_CD recordStatusCd, VER_NUM verNum, EXT_PROD_INST_ID extProdInstId, POINT_OWNER_ID pointOwnerId, OWNER_CUST_NAME ownerCustName, USE_CUST_NAME useCustName, 
    POINT_OWNER_NAME pointOwnerName, ACC_PROD_ID accProdId, ACC_PROD_NAME accProdName, OUTER_PROD_INST_ID outerProdInstId, CDMA_IMSI cdmaImsi, GSM_IMSI gsmImsi, 
    LTE_IMSI lteImsi
    FROM ORD_PROD_INST
     WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
     AND PROD_USE_TYPE = 1000
	 AND ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT}     
	 AND OPER_TYPE IN (1000, 1300)     
</select>

<select id="selectOrdProdInstAttr2000" resultType="java.util.Map" parameterType="map">
    SELECT 
    ARCH_GRP_ID, ORDER_ITEM_ID, PROD_INST_ID prodInstId, PROD_ID prodId, ACC_PROD_INST_ID accProdInstId, PROD_USE_TYPE prodUseType, 
    ACC_NUM accNum, ACCOUNT account, PAYMENT_MODE_CD paymentModeCd, ADDRESS_DESC addressDesc, OWNER_CUST_ID ownerCustId, PROD_INST_PWD prodInstPwd, EXCH_ID exchId, 
    ADDRESS_ID addressId, REGION_ID regionId, LAN_ID lanId, ACT_DATE actDate, BEGIN_RENT_DATE beginRentDate, STOP_RENT_DATE stopRentDate, CREATE_ORG_ID createOrgId, 
    FIRST_FINISH_DATE firstFinishDate, BUSI_MOD_DATE busiModDate, USE_CUST_ID useCustId, ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType, STATUS_CD statusCd, 
    STATUS_DATE statusDate, CREATE_STAFF createStaff, CREATE_DATE createDate, UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark, PROD_FUNC_TYPE prodFuncType, 
    RECORD_STATUS_CD recordStatusCd, VER_NUM verNum, EXT_PROD_INST_ID extProdInstId, POINT_OWNER_ID pointOwnerId, OWNER_CUST_NAME ownerCustName, USE_CUST_NAME useCustName, 
    POINT_OWNER_NAME pointOwnerName, ACC_PROD_ID accProdId, ACC_PROD_NAME accProdName, OUTER_PROD_INST_ID outerProdInstId, CDMA_IMSI cdmaImsi, GSM_IMSI gsmImsi, 
    LTE_IMSI lteImsi
    FROM ORD_PROD_INST
     WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
     AND PROD_USE_TYPE = 2000
	 AND ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT}     
	 AND OPER_TYPE IN (1000, 1300)     
</select>
<insert id="insertTifFeeBill" parameterType="map" >
    insert into tif_fee_bill
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="areaCode != null" >
        AREA_CODE,
      </if>
      <if test="serialnumber != null" >
        SERIALNUMBER,
      </if>
      <if test="feeSerial != null" >
        FEE_SERIAL,
      </if>
      <if test="orderNo != null" >
        ORDER_NO,
      </if>
      <if test="userId != null" >
        USER_ID,
      </if>
      <if test="acctItemType != null" >
        ACCT_ITEM_TYPE,
      </if>
      <if test="payCharge != null" >
        PAY_CHARGE,
      </if>
      <if test="payTimes != null" >
        PAY_TIMES,
      </if>
      <if test="feeDate != null" >
        FEE_DATE,
      </if>
      <if test="effDate != null" >
        EFF_DATE,
      </if>
      <if test="state != null" >
        STATE,
      </if>
      <if test="notes != null" >
        NOTES,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="areaCode != null" >
        #{areaCode,jdbcType=BIGINT},
      </if>
      <if test="serialnumber != null" >
        #{serialnumber,jdbcType=BIGINT},
      </if>
      <if test="feeSerial != null" >
        #{feeSerial,jdbcType=BIGINT},
      </if>
      <if test="orderNo != null" >
        #{orderNo,jdbcType=BIGINT},
      </if>
      <if test="userId != null" >
        #{userId,jdbcType=BIGINT},
      </if>
      <if test="acctItemType != null" >
        #{acctItemType,jdbcType=BIGINT},
      </if>
      <if test="payCharge != null" >
        #{payCharge,jdbcType=DECIMAL},
      </if>
      <if test="payTimes != null" >
        #{payTimes,jdbcType=BIGINT},
      </if>
      <if test="feeDate != null" >
        #{feeDate,jdbcType=DATE},
      </if>
      <if test="effDate != null" >
        #{effDate,jdbcType=DATE},
      </if>
      <if test="state != null" >
        #{state,jdbcType=INTEGER},
      </if>
      <if test="notes != null" >
        #{notes,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>

<select id="getOneItemAcctId" resultType="map" parameterType="map"  >
select acct_id acctId from prod_inst_acct_rel 
where PROD_INST_ID=#{prodInstId,jdbcType=BIGINT} 


</select>

<select id="getOneItemInstId" resultType="map" parameterType="map"  >
select OBJ_ID prodInstId from offer_obj_inst_rel 
where OFFER_INST_ID=#{offerInstId,jdbcType=BIGINT} 

</select>


<select id="getOfferInstAcctId" resultType="map" parameterType="map"  >
select a.offer_inst_id,b.PROD_INST_ID prodInstId from ord_offer_inst a ,ord_offer_prod_inst_rel b
where 
a.ARCH_GRP_ID =b.ARCH_GRP_ID
AND  a.ORDER_ITEM_ID = b.ORDER_ITEM_ID
and a.ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
AND  a.ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT} 
</select>


<select id="getPOfferPayPlan" resultType="int" parameterType="map"  >
SELECT 
 count(1)
 FROM P_OFFER_PAYPLAN_INFO
 WHERE offer_id = #{offerId,jdbcType=BIGINT}
</select>

 <update id="updateOneItemResult" parameterType="map" >
    update one_item_result
    <set >
      <if test="procFlag != null" >
        PROC_FLAG = 1  ,
      </if>
      <if test="remarks != null" >
        REMARKS = #{remarks,jdbcType=VARCHAR}
      </if>
    </set>
    where  ARCH_GRP_ID = #{archGrpId,jdbcType=BIGINT}
  </update>
    <insert id="insertOneItemResultHis" parameterType="map">
        insert into one_item_result_his
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="oneAcctItemId != null">
                ONE_ACCT_ITEM_ID,
            </if>
            <if test="archGrpId != null">
                ARCH_GRP_ID,
            </if>
            <if test="custOrderId != null">
                CUST_ORDER_ID,
            </if>
            <if test="orderItemId != null">
                ORDER_ITEM_ID,
            </if>
            <if test="sourceType != null">
                SOURCE_TYPE,
            </if>
            <if test="billId != null">
                BILL_ID,
            </if>
            <if test="paymentId != null">
                PAYMENT_ID,
            </if>
            <if test="acctItemTypeId != null">
                ACCT_ITEM_TYPE_ID,
            </if>
            <if test="billAcctItemTypeId != null">
                BILL_ACCT_ITEM_TYPE_ID,
            </if>
            <if test="balanceTypeId != null">
                BALANCE_TYPE_ID,
            </if>
            <if test="billingCycleId != null">
                BILLING_CYCLE_ID,
            </if>
            <if test="itemSourceId != null">
                ITEM_SOURCE_ID,
            </if>
            <if test="acctId != null">
                ACCT_ID,
            </if>
            <if test="prodInstId != null">
                PROD_INST_ID,
            </if>
            <if test="offerInstId != null">
                OFFER_INST_ID,
            </if>
            <if test="offerId != null">
                OFFER_ID,
            </if>
            <if test="realAmount != null">
                REAL_AMOUNT,
            </if>
            <if test="taxRateConfigId != null">
                TAX_RATE_CONFIG_ID,
            </if>
            <if test="taxRate != null">
                TAX_RATE,
            </if>
            <if test="tax != null">
                TAX,
            </if>
            <if test="price != null">
                PRICE,
            </if>
            <if test="resultItemType != null">
                RESULT_ITEM_TYPE,
            </if>
            <if test="createDate != null">
                CREATE_DATE,
            </if>
            <if test="chargeMethod != null">
                CHARGE_METHOD,
            </if>
            <if test="statusCd != null">
                STATUS_CD,
            </if>
            <if test="statusDate != null">
                STATUS_DATE,
            </if>
            <if test="oriAcctItemId != null">
                ORI_ACCT_ITEM_ID,
            </if>
            <if test="lanId != null">
                LAN_ID,
            </if>
            <if test="ifChargeOff != null">
                IF_CHARGE_OFF,
            </if>
            <if test="mergeAcctDealTime != null">
                MERGE_ACCT_DEAL_TIME,
            </if>
            <if test="paidInAmount != null">
                PAID_IN_AMOUNT,
            </if>
            <if test="receiptId != null">
                RECEIPT_ID,
            </if>
            <if test="busiName != null">
                BUSI_NAME,
            </if>
            <if test="extAcctItemId != null">
                EXT_ACCT_ITEM_ID,
            </if>
            <if test="prodId != null">
                PROD_ID,
            </if>
            <if test="staffId != null">
                STAFF_ID,
            </if>
            <if test="orgId != null">
                ORG_ID,
            </if>
            <if test="procFlag != null">
                PROC_FLAG,
            </if>
            <if test="remarks != null">
                REMARKS,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="oneAcctItemId != null">
                #{oneAcctItemId,jdbcType=BIGINT},
            </if>
            <if test="archGrpId != null">
                #{archGrpId,jdbcType=BIGINT},
            </if>
            <if test="custOrderId != null">
                #{custOrderId,jdbcType=BIGINT},
            </if>
            <if test="orderItemId != null">
                #{orderItemId,jdbcType=BIGINT},
            </if>
            <if test="sourceType != null">
                #{sourceType,jdbcType=INTEGER},
            </if>
            <if test="billId != null">
                #{billId,jdbcType=BIGINT},
            </if>
            <if test="paymentId != null">
                #{paymentId,jdbcType=BIGINT},
            </if>
            <if test="acctItemTypeId != null">
                #{acctItemTypeId,jdbcType=BIGINT},
            </if>
            <if test="billAcctItemTypeId != null">
                #{billAcctItemTypeId,jdbcType=BIGINT},
            </if>
            <if test="balanceTypeId != null">
                #{balanceTypeId,jdbcType=BIGINT},
            </if>
            <if test="billingCycleId != null">
                #{billingCycleId,jdbcType=BIGINT},
            </if>
            <if test="itemSourceId != null">
                #{itemSourceId,jdbcType=BIGINT},
            </if>
            <if test="acctId != null">
                #{acctId,jdbcType=BIGINT},
            </if>
            <if test="prodInstId != null">
                #{prodInstId,jdbcType=BIGINT},
            </if>
            <if test="offerInstId != null">
                #{offerInstId,jdbcType=BIGINT},
            </if>
            <if test="offerId != null">
                #{offerId,jdbcType=BIGINT},
            </if>
            <if test="realAmount != null">
                #{realAmount,jdbcType=BIGINT},
            </if>
            <if test="taxRateConfigId != null">
                #{taxRateConfigId,jdbcType=BIGINT},
            </if>
            <if test="taxRate != null">
                #{taxRate,jdbcType=DECIMAL},
            </if>
            <if test="tax != null">
                #{tax,jdbcType=BIGINT},
            </if>
            <if test="price != null">
                #{price,jdbcType=BIGINT},
            </if>
            <if test="resultItemType != null">
                #{resultItemType,jdbcType=INTEGER},
            </if>
            <if test="createDate != null">
                #{createDate,jdbcType=TIMESTAMP},
            </if>
            <if test="chargeMethod != null">
                #{chargeMethod,jdbcType=BIGINT},
            </if>
            <if test="statusCd != null">
                #{statusCd,jdbcType=BIGINT},
            </if>
            <if test="statusDate != null">
                #{statusDate,jdbcType=TIMESTAMP},
            </if>
            <if test="oriAcctItemId != null">
                #{oriAcctItemId,jdbcType=BIGINT},
            </if>
            <if test="lanId != null">
                #{lanId,jdbcType=BIGINT},
            </if>
            <if test="ifChargeOff != null">
                #{ifChargeOff,jdbcType=INTEGER},
            </if>
            <if test="mergeAcctDealTime != null">
                #{mergeAcctDealTime,jdbcType=TIMESTAMP},
            </if>
            <if test="paidInAmount != null">
                #{paidInAmount,jdbcType=BIGINT},
            </if>
            <if test="receiptId != null">
                #{receiptId,jdbcType=BIGINT},
            </if>
            <if test="busiName != null">
                #{busiName,jdbcType=VARCHAR},
            </if>
            <if test="extAcctItemId != null">
                #{extAcctItemId,jdbcType=VARCHAR},
            </if>
            <if test="prodId != null">
                #{prodId,jdbcType=BIGINT},
            </if>
            <if test="staffId != null">
                #{staffId,jdbcType=BIGINT},
            </if>
            <if test="orgId != null">
                #{orgId,jdbcType=BIGINT},
            </if>
            <if test="procFlag != null">
                #{procFlag,jdbcType=INTEGER},
            </if>
            <if test="remarks != null">
                #{remarks,jdbcType=VARCHAR},
            </if>
        </trim>
    </insert>

<insert id="insertPayToPlan" parameterType="map" >
    insert into inter_pay_to_plan
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="interPlanId != null" >
        inter_plan_id,
      </if>
      <if test="offerInstId != null" >
        offer_inst_id,
      </if>
      <if test="offerId != null" >
        offer_id,
      </if>
      <if test="objectType != null" >
        object_type,
      </if>
      <if test="objectId != null" >
        object_id,
      </if>
      <if test="operType != null" >
        oper_type,
      </if>
      <if test="operState != null" >
        oper_state,
      </if>
      <if test="effDate != null" >
        eff_date,
      </if>
      <if test="orderDate != null" >
        order_date,
      </if>
      <if test="createDate != null" >
        create_date,
      </if>
      <if test="operDate != null" >
        oper_date,
      </if>
       <if test="acctId != null" >
        acct_id,
      </if>
      <if test="amount != null" >
        amount
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="interPlanId != null" >
        #{interPlanId,jdbcType=BIGINT},
      </if>
      <if test="offerInstId != null" >
        #{offerInstId,jdbcType=BIGINT},
      </if>
      <if test="offerId != null" >
        #{offerId,jdbcType=BIGINT},
      </if>
      <if test="objectType != null" >
        #{objectType,jdbcType=BIGINT},
      </if>
      <if test="objectId != null" >
        #{objectId,jdbcType=BIGINT},
      </if>
      <if test="operType != null" >
        #{operType,jdbcType=BIGINT},
      </if>
      <if test="operState != null" >
        #{operState,jdbcType=BIGINT},
      </if>
      <if test="effDate != null" >
        #{effDate,jdbcType=TIMESTAMP},
      </if>
      <if test="orderDate != null" >
        #{orderDate,jdbcType=TIMESTAMP},
      </if>
      <if test="createDate != null" >
        #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="operDate != null" >
        #{operDate,jdbcType=TIMESTAMP},
      </if>
      <if test="acctId != null" >
        #{acctId,jdbcType=BIGINT},
      </if>
      <if test="amount != null" >
        #{amount,jdbcType=DECIMAL}
      </if>
    </trim>
  </insert>
<select id="getOneItemResult" resultType="java.util.Map" parameterType="map"  >
SELECT 
 ARCH_GRP_ID, ONE_ACCT_ITEM_ID, CUST_ORDER_ID, ORDER_ITEM_ID, SOURCE_TYPE, BILL_ID, 
    PAYMENT_ID, ACCT_ITEM_TYPE_ID, BILL_ACCT_ITEM_TYPE_ID, BALANCE_TYPE_ID, BILLING_CYCLE_ID, 
    ITEM_SOURCE_ID, ACCT_ID, PROD_INST_ID, OFFER_INST_ID, OFFER_ID, REAL_AMOUNT, TAX_RATE_CONFIG_ID, 
    TAX_RATE, TAX, PRICE, RESULT_ITEM_TYPE, CREATE_DATE, CHARGE_METHOD, STATUS_CD, STATUS_DATE, 
    ORI_ACCT_ITEM_ID, LAN_ID, IF_CHARGE_OFF, MERGE_ACCT_DEAL_TIME, PAID_IN_AMOUNT, RECEIPT_ID, 
    BUSI_NAME, EXT_ACCT_ITEM_ID, PROD_ID, STAFF_ID, ORG_ID, PROC_FLAG, REMARKS
 FROM ONE_ITEM_RESULT
 WHERE PROC_FLAG=0  limit 0, 10
</select>

<select id="getOrdOfferInstOfferId" resultType="java.util.Map" parameterType="map"  >
SELECT 
    ARCH_GRP_ID, ORDER_ITEM_ID, OFFER_INST_ID offerInstId, OFFER_ID offerId, OFFER_TYPE offerType, OWNER_CUST_ID ownerCustId, EFF_DATE effDate, 
    EXP_DATE expDate, OFFER_AGREE_ID offerAgreeId, CREATE_ORG_ID createOrgId, EXP_PROC_METHOD expProcMethod, LAN_ID lanId, REGION_ID regionId, BUSI_MOD_DATE busiModDate, 
    ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType, STATUS_CD statusCd, STATUS_DATE statusDate, CREATE_STAFF createStaff, CREATE_DATE createDate, 
    UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark, VER_NUM verNum, EXT_OFFER_INST_ID extOfferInstId, IS_INDEPENDENT isIndependent, OWNER_CUST_NAME ownerCustName, 
    OUTER_OFFER_INST_ID outerOfferInstId, OFFER_CODE offerCode
FROM  ORD_OFFER_INST
WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
     AND  ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT} 
     and  OFFER_INST_ID = #{offerInstId,jdbcType=BIGINT} 
<!--      and oper_type=1000 -->
</select>


<select id="selectOrdOfferInstAttr" resultType="java.util.Map" parameterType="map"  >
select 
  ARCH_GRP_ID, ORDER_ITEM_ID, OFFER_INST_ATTR_ID offerInstAttrId, OFFER_INST_ID offerInstId, PAR_OFFER_INST_ATTR_ID parOfferInstAttrId, 
    OBJ_TYPE objType, OBJ_ID objId, ATTR_ID attrId, ATTR_VALUE_ID attrValueId, ATTR_VALUE attrValue, EFF_DATE effDate, EXP_DATE expDate, APPLY_REGION_ID applyRegionId, 
    BUSI_MOD_EFF_DATE busiModEffDate, ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType, STATUS_CD statusCd, STATUS_DATE statusDate, CREATE_STAFF createStaff, 
    CREATE_DATE createDate, UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark, VER_NUM verNum, ATTR_CODE attrCode,OFFER_ATTR_ID offerAttrId
from ord_offer_inst_attr
 WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
     AND  ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT} 
     AND  OFFER_INST_ID = #{offerInstId,jdbcType=BIGINT}
</select>
    <select id="selectOrdOfferInstAttrDec" resultType="java.util.Map" parameterType="map"  >
select
  ARCH_GRP_ID, ORDER_ITEM_ID, OFFER_INST_ATTR_ID offerInstAttrId, OFFER_INST_ID offerInstId, PAR_OFFER_INST_ATTR_ID parOfferInstAttrId,
    OBJ_TYPE objType, OBJ_ID objId, ATTR_ID attrId, ATTR_VALUE_ID attrValueId, ATTR_VALUE attrValue, EFF_DATE effDate, EXP_DATE expDate, APPLY_REGION_ID applyRegionId,
    BUSI_MOD_EFF_DATE busiModEffDate, ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType, STATUS_CD statusCd, STATUS_DATE statusDate, CREATE_STAFF createStaff,
    CREATE_DATE createDate, UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark, VER_NUM verNum, ATTR_CODE attrCode,OFFER_ATTR_ID offerAttrId
from ord_offer_inst_attr
 WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT}
     AND  ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT}
     AND  OFFER_INST_ID = #{offerInstId,jdbcType=BIGINT}
     order by OPER_TYPE DESC
</select>
<select id="selectOrdOfferInstAttr1000" resultType="java.util.Map" parameterType="map"  >
select 
  ARCH_GRP_ID, ORDER_ITEM_ID, OFFER_INST_ATTR_ID offerInstAttrId, OFFER_INST_ID offerInstId, PAR_OFFER_INST_ATTR_ID parOfferInstAttrId, 
    OBJ_TYPE objType, OBJ_ID objId, ATTR_ID attrId, ATTR_VALUE_ID attrValueId, ATTR_VALUE attrValue, EFF_DATE effDate, EXP_DATE expDate, APPLY_REGION_ID applyRegionId, 
    BUSI_MOD_EFF_DATE busiModEffDate, ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType, STATUS_CD statusCd, STATUS_DATE statusDate, CREATE_STAFF createStaff, 
    CREATE_DATE createDate, UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark, VER_NUM verNum, ATTR_CODE attrCode
from ord_offer_inst_attr
 WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
     AND  ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT} 
     AND  OFFER_INST_ID = #{offerInstId,jdbcType=BIGINT}
     AND  OPER_TYPE = 1000
</select>
<select id="selectOrdOfferObjInstRel" resultType="java.util.Map" parameterType="map"  >
select
 ARCH_GRP_ID, ORDER_ITEM_ID, OFFER_OBJ_INST_REL_ID offerObjInstRelId, OFFER_INST_ID offerInstId, OBJ_TYPE objType, OBJ_ID objId, 
    ROLE_ID roleId, EFF_DATE effDate, EXP_DATE expDate, ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType, STATUS_CD statusCd, STATUS_DATE statusDate, 
    CREATE_STAFF createStaff, CREATE_DATE createDate, UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark,  OFFER_OBJ_REL_ID offerObjRelId, VER_NUM verNum, 
    SPEC_ID specId, OBJ_NAME objName, ROLE_NAME roleName
 from ORD_OFFER_OBJ_INST_REL
 WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
     AND  ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT} 
     AND OFFER_INST_ID = #{offerInstId,jdbcType=BIGINT} 
</select>
    <select id="selectOrdOfferObjInstRelForObjectId" resultType="java.util.Map" parameterType="map"  >
select OBJ_ID objId
 from ORD_OFFER_OBJ_INST_REL
 WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT}
     AND OFFER_INST_ID = #{offerInstId,jdbcType=BIGINT}
</select>
<select id="selectOrdOfferProdInstRel" resultType="java.util.Map" parameterType="map"  >
SELECT 
 ARCH_GRP_ID, ORDER_ITEM_ID, OFFER_PROD_INST_REL_ID offerProdInstRelId, OFFER_INST_ID offerInstId, PROD_INST_ID prodInstId, 
    REL_TYPE relType, EFF_DATE effDate, EXP_DATE expDate, ROLE_ID roleId, ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType, STATUS_CD statusCd, 
    STATUS_DATE statusDate, CREATE_STAFF createStaff, CREATE_DATE createDate, UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark, OFFER_PROD_REL_ID offerProdRelId, 
    VER_NUM verNum, PROD_FUNC_TYPE prodFuncType, PROD_ID prodId, ACC_PROD_INST_ID accProdInstId, ACC_NUM accNum, ROLE_NAME roleName, PROD_NAME prodName, 
    PROD_USE_TYPE prodUseType, PI_REGION_ID piRegionId
FROM ORD_OFFER_PROD_INST_REL
WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
     AND  ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT} 
     <!--and prod_use_type=1000 -->
     and OFFER_INST_ID = #{offerInstId,jdbcType=BIGINT} 
</select>
<select id="selectOrdOfferProdInstRel1300" resultType="java.util.Map" parameterType="map"  >
SELECT 
 ARCH_GRP_ID, ORDER_ITEM_ID, OFFER_PROD_INST_REL_ID offerProdInstRelId, OFFER_INST_ID offerInstId, PROD_INST_ID prodInstId, 
    REL_TYPE relType, EFF_DATE effDate, EXP_DATE expDate, ROLE_ID roleId, ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType, STATUS_CD statusCd, 
    STATUS_DATE statusDate, CREATE_STAFF createStaff, CREATE_DATE createDate, UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark, OFFER_PROD_REL_ID offerProdRelId, 
    VER_NUM verNum, PROD_FUNC_TYPE prodFuncType, PROD_ID prodId, ACC_PROD_INST_ID accProdInstId, ACC_NUM accNum, ROLE_NAME roleName, PROD_NAME prodName, 
    PROD_USE_TYPE prodUseType, PI_REGION_ID piRegionId
FROM ORD_OFFER_PROD_INST_REL
WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
     and OPER_TYPE=1300
     and OFFER_INST_ID = #{offerInstId,jdbcType=BIGINT} 
</select>
    <select id="selectOrdOfferProdInstRelForProdInst" resultType="java.util.Map" parameterType="map"  >
SELECT PROD_INST_ID prodInstId
FROM ORD_OFFER_PROD_INST_REL
WHERE ARCH_GRP_ID = #{archGrpId,jdbcType=BIGINT}
     and OFFER_INST_ID = #{offerInstId,jdbcType=BIGINT}
</select>
<select id="selectOrdOfferInst" resultType="java.util.Map" parameterType="map"  >
SELECT 
    ARCH_GRP_ID, ORDER_ITEM_ID, OFFER_INST_ID offerInstId, OFFER_ID offerId, OFFER_TYPE offerType, OWNER_CUST_ID ownerCustId, EFF_DATE effDate, 
    EXP_DATE expDate, OFFER_AGREE_ID offerAgreeId, CREATE_ORG_ID createOrgId, EXP_PROC_METHOD expProcMethod, LAN_ID lanId, REGION_ID regionId, BUSI_MOD_DATE busiModDate, 
    ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType, STATUS_CD statusCd, STATUS_DATE statusDate, CREATE_STAFF createStaff, CREATE_DATE createDate, 
    UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark, VER_NUM verNum, EXT_OFFER_INST_ID extOfferInstId, IS_INDEPENDENT isIndependent, OWNER_CUST_NAME ownerCustName, 
    OUTER_OFFER_INST_ID outerOfferInstId, OFFER_CODE offerCode
FROM  ORD_OFFER_INST
WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
     AND  ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT} 
<!--       <if test="rowId != null" >
        AND ROW_ID=#{rowId,jdbcType=BIGINT} 
      </if> -->    
 ORDER BY OPER_TYPE, ROW_ID
</select>

    <select id="selectCntOrdOfferProdInst" resultType="java.lang.Long" parameterType="map"  >
        SELECT
        count(1)
        FROM  ORD_OFFER_INST a, ord_offer_prod_inst_rel b
        WHERE a.ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT}
        AND  a.ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT}
        and a.offer_inst_id = #{offerInstId,jdbcType=BIGINT }
        and a.offer_inst_id = b.offer_inst_id
       and a.ARCH_GRP_ID = b.ARCH_GRP_ID
       and a.ORDER_ITEM_ID = b.ORDER_ITEM_ID
    </select>
<!-- add by wangbaoqiang -->
<select id="selectOrdOfferInstFromRowId" resultType="java.util.Map" parameterType="map"  >
SELECT 
    ARCH_GRP_ID, ORDER_ITEM_ID, OFFER_INST_ID offerInstId, OFFER_ID offerId, OFFER_TYPE offerType, OWNER_CUST_ID ownerCustId, EFF_DATE effDate, 
    EXP_DATE expDate, OFFER_AGREE_ID offerAgreeId, CREATE_ORG_ID createOrgId, EXP_PROC_METHOD expProcMethod, LAN_ID lanId, REGION_ID regionId, BUSI_MOD_DATE busiModDate, 
    ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType, STATUS_CD statusCd, STATUS_DATE statusDate, CREATE_STAFF createStaff, CREATE_DATE createDate, 
    UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark, VER_NUM verNum, EXT_OFFER_INST_ID extOfferInstId, IS_INDEPENDENT isIndependent, OWNER_CUST_NAME ownerCustName, 
    OUTER_OFFER_INST_ID outerOfferInstId, OFFER_CODE offerCode
FROM  ORD_OFFER_INST
WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT}     
        AND ROW_ID=#{rowId,jdbcType=BIGINT} 
</select>
<select id="selectOrdProdInstAcctRel" resultType="java.util.Map" parameterType="map"  >
SELECT 
ARCH_GRP_ID, ORDER_ITEM_ID, PROD_INST_ACCT_REL_ID prodInstAcctRelId, ACCT_ID acctId, ACCT_ITEM_GROUP_ID acctItemGroupId, PROD_INST_ID prodInstId, 
    PRIORITY priority, PAYMENT_LIMIT_TYPE paymentLimitType, PAYMENT_LIMIT paymentLimit, UPPER_AMOUNT upperAmount, IF_DEFAULT_ACCT_ID ifDefaultAcctId, ROW_ID rowId, 
    OLD_ROW_ID oldRowId, OPER_TYPE operType, STATUS_CD statusCd, STATUS_DATE statusDate, EFF_DATE effDate, EXP_DATE expDate, AGREE_ID agreeId, CREATE_STAFF createStaff, 
    CREATE_DATE createDate, UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, VER_NUM verNum
FROM ORD_PROD_INST_ACCT_REL
WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
     AND  ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT} 
     order by oper_type desc
</select>
<!-- add by wangbaoqiang begin -->
<select id="selectOrdProdInstAcctRel1000" resultType="java.util.Map" parameterType="map"  >
SELECT 
ARCH_GRP_ID, ORDER_ITEM_ID, PROD_INST_ACCT_REL_ID prodInstAcctRelId, ACCT_ID acctId, ACCT_ITEM_GROUP_ID acctItemGroupId, PROD_INST_ID prodInstId, 
    PRIORITY priority, PAYMENT_LIMIT_TYPE paymentLimitType, PAYMENT_LIMIT paymentLimit, UPPER_AMOUNT upperAmount, IF_DEFAULT_ACCT_ID ifDefaultAcctId, ROW_ID rowId, 
    OLD_ROW_ID oldRowId, OPER_TYPE operType, STATUS_CD statusCd, STATUS_DATE statusDate, EFF_DATE effDate, EXP_DATE expDate, AGREE_ID agreeId, CREATE_STAFF createStaff, 
    CREATE_DATE createDate, UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, VER_NUM verNum
FROM ORD_PROD_INST_ACCT_REL
WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
     AND  ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT} 
     AND oper_Type = 1000
</select>
<select id="selectOrdProdInstAcctRel1100" resultType="java.util.Map" parameterType="map"  >
SELECT 
ARCH_GRP_ID, ORDER_ITEM_ID, PROD_INST_ACCT_REL_ID prodInstAcctRelId, ACCT_ID acctId, ACCT_ITEM_GROUP_ID acctItemGroupId, PROD_INST_ID prodInstId, 
    PRIORITY priority, PAYMENT_LIMIT_TYPE paymentLimitType, PAYMENT_LIMIT paymentLimit, UPPER_AMOUNT upperAmount, IF_DEFAULT_ACCT_ID ifDefaultAcctId, ROW_ID rowId, 
    OLD_ROW_ID oldRowId, OPER_TYPE operType, STATUS_CD statusCd, STATUS_DATE statusDate, EFF_DATE effDate, EXP_DATE expDate, AGREE_ID agreeId, CREATE_STAFF createStaff, 
    CREATE_DATE createDate, UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, VER_NUM verNum
FROM ORD_PROD_INST_ACCT_REL
WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
     AND  ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT} 
     AND OPER_TYPE = 1100
</select>

<!-- add end -->
<select id="selectOrdProdInstRel" resultType="java.util.Map" parameterType="map"  >
SELECT 
 ARCH_GRP_ID, ORDER_ITEM_ID, PROD_INST_REL_ID prodInstRelId, A_PROD_INST_ID aProdInstId, Z_PROD_INST_ID zProdInstId, REL_TYPE relType, 
    ROLE_ID roleId, ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType, STATUS_CD statusCd, STATUS_DATE statusDate, CREATE_STAFF createStaff, CREATE_DATE createDate, 
    UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark, VER_NUM verNum, EFF_DATE effDate, EXP_DATE expDate
FROM  ORD_PROD_INST_REL
WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
     AND  ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT} 
    order by ROW_ID


</select>
    <select id="selectOrdProdInstRelFromRowId" resultType="java.util.Map" parameterType="map"  >
SELECT
 ARCH_GRP_ID, ORDER_ITEM_ID, PROD_INST_REL_ID prodInstRelId, A_PROD_INST_ID aProdInstId, Z_PROD_INST_ID zProdInstId, REL_TYPE relType,
    ROLE_ID roleId, ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType, STATUS_CD statusCd, STATUS_DATE statusDate, CREATE_STAFF createStaff, CREATE_DATE createDate,
    UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark, VER_NUM verNum, EFF_DATE effDate, EXP_DATE expDate
FROM  ORD_PROD_INST_REL
WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT}
     AND  ROW_ID = #{rowId,jdbcType=BIGINT}
</select>
<!-- add end -->
<select id="selectOrdProdInstRelFrom1000" resultType="java.util.Map" parameterType="map"  >
SELECT 
  IFNULL(group_concat(Z_PROD_INST_ID),-1) zProdInstId
    FROM  ORD_PROD_INST_REL
WHERE A_PROD_INST_ID = #{prodInstId,jdbcType=BIGINT} 
     AND  OPER_TYPE = 1000
</select>

<!-- add by wangbaoqiang -->
<select id="selectOrdProdInstRelForGroup" resultType="java.util.Map" parameterType="map"  >
SELECT 
 ARCH_GRP_ID, ORDER_ITEM_ID, PROD_INST_REL_ID prodInstRelId, A_PROD_INST_ID aProdInstId, Z_PROD_INST_ID zProdInstId, REL_TYPE relType, 
    ROLE_ID roleId, ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType, STATUS_CD statusCd, STATUS_DATE statusDate, CREATE_STAFF createStaff, CREATE_DATE createDate, 
    UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark, VER_NUM verNum, EFF_DATE effDate, EXP_DATE expDate,A_PROD_ID aProdId
FROM  ORD_PROD_INST_REL
WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
     AND  ROW_ID = #{rowId,jdbcType=BIGINT} 
</select>
<!-- add end -->
<select id="selectOrdProdInstAttr" resultType="java.util.Map" parameterType="map"  >
SELECT 
ARCH_GRP_ID, ORDER_ITEM_ID, PROD_INST_ATTR_ID prodInstAttrId, PAR_PROD_INST_ATTR_ID  parProdInstAttrId, PROD_INST_ID prodInstId, 
    ATTR_ID attrId, ATTR_VALUE_ID attrValueId, ATTR_VALUE attrValue, BUSI_MOD_DATE busiModDate, ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType, 
    STATUS_CD statusCd, STATUS_DATE statusDate, CREATE_STAFF createStaff, CREATE_DATE createDate, UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark, 
    VER_NUM verNum, ATTR_CODE attrCode
FROM ORD_PROD_INST_ATTR
WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
     AND  ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT}
    order by ROW_ID
</select>

    <select id="selectOrdProdInstAttrFromRowId" resultType="java.util.Map" parameterType="map"  >
SELECT
ARCH_GRP_ID, ORDER_ITEM_ID, PROD_INST_ATTR_ID prodInstAttrId, PAR_PROD_INST_ATTR_ID  parProdInstAttrId, PROD_INST_ID prodInstId,
    ATTR_ID attrId, ATTR_VALUE_ID attrValueId, ATTR_VALUE attrValue, BUSI_MOD_DATE busiModDate, ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType,
    STATUS_CD statusCd, STATUS_DATE statusDate, CREATE_STAFF createStaff, CREATE_DATE createDate, UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark,
    VER_NUM verNum, ATTR_CODE attrCode
FROM ORD_PROD_INST_ATTR
WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT}
     AND  ROW_ID = #{rowId,jdbcType=BIGINT}
</select>
<!-- add by wangbaoqiang 中继类型判断 -->
<select id="selectOrdProdInstAttrForTrunk" resultType="java.util.Map" parameterType="map"  >
SELECT 
ARCH_GRP_ID, ORDER_ITEM_ID, PROD_INST_ATTR_ID prodInstAttrId, PAR_PROD_INST_ATTR_ID  parProdInstAttrId, PROD_INST_ID prodInstId, 
    ATTR_ID attrId, ATTR_VALUE_ID attrValueId, ATTR_VALUE attrValue, BUSI_MOD_DATE busiModDate, ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType, 
    STATUS_CD statusCd, STATUS_DATE statusDate, CREATE_STAFF createStaff, CREATE_DATE createDate, UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark, 
    VER_NUM verNum, ATTR_CODE attrCode
FROM ORD_PROD_INST_ATTR
WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
     AND  ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT} 
     AND OPER_TYPE = 1000
     AND ATTR_ID = 11010149
</select>
<!-- add end -->
<select id="selectOrdProdInstAccNum" resultType="java.util.Map" parameterType="map"  >
SELECT 
   ARCH_GRP_ID, ORDER_ITEM_ID, PROD_INST_ACC_NUM_ID prodInstAccNumId, PROD_INST_ID prodInstId, ACC_NUM_TYPE accNumType, ACC_NUM accNum, 
    PLAT_ID platId, PASSWORD password, APPLY_REGION_ID applyRegionId, ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType, STATUS_CD statusCd, STATUS_DATE statusDate, 
    CREATE_STAFF createStaff, CREATE_DATE createDate, UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark, AN_ID anId, VER_NUM verNum, AN_TYPE_CD anTypeCd
FROM ORD_PROD_INST_ACC_NUM
  WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
     AND  ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT} 
     AND OPER_TYPE = 1000
	   <if test="accNum != null">
	     and ACC_NUM = #{accNum,jdbcType=VARCHAR} 
	   </if>
</select>

<select id="selectOrdProdInstState1100" resultType="java.util.Map" parameterType="map"  >
select 
  ARCH_GRP_ID, ORDER_ITEM_ID, PROD_INST_STATE_ID prodInstStateId, PROD_INST_ID prodInstId, STOP_TYPE stopType, EFF_DATE effDate, 
    EXP_DATE expDate, STOP_DIRECTION stopDirection, STOP_REASON stopReason, EVENT_DATE eventDate, ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType, 
    STATUS_CD statusCd, STATUS_DATE statusDate, CREATE_STAFF createStaff, CREATE_DATE createDate, UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark, 
    VER_NUM verNum
    from ord_prod_inst_state
    WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
     AND  ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT} 
     AND OPER_TYPE = 1100
      <if test="prod_inst_id != null">
	     and prod_inst_id = #{prodInstId,jdbcType=BIGINT} 
	   </if>
</select>

<select id="selectOrdProdInstState" resultType="java.util.Map" parameterType="map"  >
select 
  ARCH_GRP_ID, ORDER_ITEM_ID, PROD_INST_STATE_ID prodInstStateId, PROD_INST_ID prodInstId, STOP_TYPE stopType, EFF_DATE effDate, 
    EXP_DATE expDate, STOP_DIRECTION stopDirection, STOP_REASON stopReason, EVENT_DATE eventDate, ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType, 
    STATUS_CD statusCd, STATUS_DATE statusDate, CREATE_STAFF createStaff, CREATE_DATE createDate, UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark, 
    VER_NUM verNum
    from ord_prod_inst_state
    WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
     AND  ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT} 
     AND OPER_TYPE = 1000
      <if test="prod_inst_id != null">
	     and prod_inst_id = #{prodInstId,jdbcType=BIGINT} 
	   </if>
</select>

<select id="getOrdAccountByAcctRel" resultType="map" parameterType="map"  >
    select acct_id  
     from ord_prod_inst_acct_rel
          WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
<!--      AND  ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT}  -->
     AND OPER_TYPE = 1000
</select>

<select id="getOrdAccountById" resultType="java.lang.Long" parameterType="map"  >
    select acct_id  
     from ord_account
     WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
     AND  ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT} 
     AND OPER_TYPE = 1000
</select>
  
<select id="selectOrdProdInstSub" resultType="java.util.Map" parameterType="map"  >
    SELECT 
    ARCH_GRP_ID, ORDER_ITEM_ID, PROD_INST_ID prodInstId, PROD_ID prodId, ACC_PROD_INST_ID accProdInstId, PROD_USE_TYPE prodUseType, 
    ACC_NUM accNum, ACCOUNT account, PAYMENT_MODE_CD paymentModeCd, ADDRESS_DESC addressDesc, OWNER_CUST_ID ownerCustId, PROD_INST_PWD prodInstPwd, EXCH_ID exchId, 
    ADDRESS_ID addressId, REGION_ID regionId, LAN_ID lanId, ACT_DATE actDate, BEGIN_RENT_DATE beginRentDate, STOP_RENT_DATE stopRentDate, CREATE_ORG_ID createOrgId, 
    FIRST_FINISH_DATE firstFinishDate, BUSI_MOD_DATE busiModDate, USE_CUST_ID useCustId, ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType, STATUS_CD statusCd, 
    STATUS_DATE statusDate, CREATE_STAFF createStaff, CREATE_DATE createDate, UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark, PROD_FUNC_TYPE prodFuncType, 
    RECORD_STATUS_CD recordStatusCd, VER_NUM verNum, EXT_PROD_INST_ID extProdInstId, POINT_OWNER_ID pointOwnerId, OWNER_CUST_NAME ownerCustName, USE_CUST_NAME useCustName, 
    POINT_OWNER_NAME pointOwnerName, ACC_PROD_ID accProdId, ACC_PROD_NAME accProdName, OUTER_PROD_INST_ID outerProdInstId, CDMA_IMSI cdmaImsi, GSM_IMSI gsmImsi, 
    LTE_IMSI lteImsi
    FROM ORD_PROD_INST
     WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
     AND  ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT} 
     AND PROD_USE_TYPE = 2000
     and oper_Type = 1000
     order by ORDER_ITEM_ID
     
  
</select>
<!--  add by wangbaoqiang begin-->
<select id="selectOrdProdInstSub1300" resultType="java.util.Map" parameterType="map"  >
    SELECT 
    ARCH_GRP_ID, ORDER_ITEM_ID, PROD_INST_ID prodInstId, PROD_ID prodId, ACC_PROD_INST_ID accProdInstId, PROD_USE_TYPE prodUseType, 
    ACC_NUM accNum, ACCOUNT account, PAYMENT_MODE_CD paymentModeCd, ADDRESS_DESC addressDesc, OWNER_CUST_ID ownerCustId, PROD_INST_PWD prodInstPwd, EXCH_ID exchId, 
    ADDRESS_ID addressId, REGION_ID regionId, LAN_ID lanId, ACT_DATE actDate, BEGIN_RENT_DATE beginRentDate, STOP_RENT_DATE stopRentDate, CREATE_ORG_ID createOrgId, 
    FIRST_FINISH_DATE firstFinishDate, BUSI_MOD_DATE busiModDate, USE_CUST_ID useCustId, ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType, STATUS_CD statusCd, 
    STATUS_DATE statusDate, CREATE_STAFF createStaff, CREATE_DATE createDate, UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark, PROD_FUNC_TYPE prodFuncType, 
    RECORD_STATUS_CD recordStatusCd, VER_NUM verNum, EXT_PROD_INST_ID extProdInstId, POINT_OWNER_ID pointOwnerId, OWNER_CUST_NAME ownerCustName, USE_CUST_NAME useCustName, 
    POINT_OWNER_NAME pointOwnerName, ACC_PROD_ID accProdId, ACC_PROD_NAME accProdName, OUTER_PROD_INST_ID outerProdInstId, CDMA_IMSI cdmaImsi, GSM_IMSI gsmImsi, 
    LTE_IMSI lteImsi
    FROM ORD_PROD_INST
     WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
     AND  ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT} 
     AND PROD_USE_TYPE = 2000
     and OPER_TYPE = 1300
     <!--order by ORDER_ITEM_ID -->
</select>
<!--  add by wangbaoqiang end-->

<select id="selectOrdProdInst" resultType="java.util.Map" parameterType="map"  >
    SELECT 
    ARCH_GRP_ID, ORDER_ITEM_ID, PROD_INST_ID prodInstId, PROD_ID prodId, ACC_PROD_INST_ID accProdInstId, PROD_USE_TYPE prodUseType, 
    ACC_NUM accNum, ACCOUNT account, PAYMENT_MODE_CD paymentModeCd, ADDRESS_DESC addressDesc, OWNER_CUST_ID ownerCustId, PROD_INST_PWD prodInstPwd, EXCH_ID exchId, 
    ADDRESS_ID addressId, REGION_ID regionId, LAN_ID lanId, ACT_DATE actDate, BEGIN_RENT_DATE beginRentDate, STOP_RENT_DATE stopRentDate, CREATE_ORG_ID createOrgId, 
    FIRST_FINISH_DATE firstFinishDate, BUSI_MOD_DATE busiModDate, USE_CUST_ID useCustId, ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType, STATUS_CD statusCd, 
    STATUS_DATE statusDate, CREATE_STAFF createStaff, CREATE_DATE createDate, UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark, PROD_FUNC_TYPE prodFuncType, 
    RECORD_STATUS_CD recordStatusCd, VER_NUM verNum, EXT_PROD_INST_ID extProdInstId, POINT_OWNER_ID pointOwnerId, OWNER_CUST_NAME ownerCustName, USE_CUST_NAME useCustName, 
    POINT_OWNER_NAME pointOwnerName, ACC_PROD_ID accProdId, ACC_PROD_NAME accProdName, OUTER_PROD_INST_ID outerProdInstId, CDMA_IMSI cdmaImsi, GSM_IMSI gsmImsi, 
    LTE_IMSI lteImsi, GRP_PROD_NBR grpProdNbr
    FROM ORD_PROD_INST
     WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
     AND  ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT} 
     AND PROD_USE_TYPE = 1000
     AND  OPER_TYPE = 1000
     <!-- <choose>
		<when test="oper_type != null and  oper_type !='' ">
			AND OPER_TYPE = #{oper_type}
		</when>
		<otherwise>
			AND OPER_TYPE = 1000
		</otherwise>
	</choose>
      -->
</select>
<select id="selectOrdProdInst1300" resultType="java.util.Map" parameterType="map"  >
    SELECT 
    ARCH_GRP_ID, ORDER_ITEM_ID, PROD_INST_ID prodInstId, PROD_ID prodId, ACC_PROD_INST_ID accProdInstId, PROD_USE_TYPE prodUseType, 
    ACC_NUM accNum, ACCOUNT account, PAYMENT_MODE_CD paymentModeCd, ADDRESS_DESC addressDesc, OWNER_CUST_ID ownerCustId, PROD_INST_PWD prodInstPwd, EXCH_ID exchId, 
    ADDRESS_ID addressId, REGION_ID regionId, LAN_ID lanId, ACT_DATE actDate, BEGIN_RENT_DATE beginRentDate, STOP_RENT_DATE stopRentDate, CREATE_ORG_ID createOrgId, 
    FIRST_FINISH_DATE firstFinishDate, BUSI_MOD_DATE busiModDate, USE_CUST_ID useCustId, ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType, STATUS_CD statusCd, 
    STATUS_DATE statusDate, CREATE_STAFF createStaff, CREATE_DATE createDate, UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark, PROD_FUNC_TYPE prodFuncType, 
    RECORD_STATUS_CD recordStatusCd, VER_NUM verNum, EXT_PROD_INST_ID extProdInstId, POINT_OWNER_ID pointOwnerId, OWNER_CUST_NAME ownerCustName, USE_CUST_NAME useCustName, 
    POINT_OWNER_NAME pointOwnerName, ACC_PROD_ID accProdId, ACC_PROD_NAME accProdName, OUTER_PROD_INST_ID outerProdInstId, CDMA_IMSI cdmaImsi, GSM_IMSI gsmImsi, 
    LTE_IMSI lteImsi, GRP_PROD_NBR grpProdNbr
    FROM ORD_PROD_INST
     WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
     AND  ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT} 
     AND PROD_USE_TYPE = 1000
     AND  OPER_TYPE = 1300
</select>
<select id="selectOrdExtAcct" resultType="java.util.Map" parameterType="map"  >
   SELECT 
    ARCH_GRP_ID, ORDER_ITEM_ID, EXT_ACCT_ID extAcctId, PAY_CHANNEL payChannel, PAY_ACCT_CODE payAcctCode, PAY_ACCT_NAME payAcctName, 
    ACCT_OWNER_ORG acctOwnerOrg, ACCT_OWNER_ORG_BRANCH acctOwnerOrgBranch, IF_CONTRACT_QUICK_PAY ifContractQuickPay, CUST_ID custId, ROW_ID rowId, OLD_ROW_ID oldRowId, 
    OPER_TYPE operType, STATUS_CD statusCd, STATUS_DATE statusDate, EFF_DATE effDate, EXP_DATE expDate, CREATE_STAFF createStaff, CREATE_DATE createDate, 
    UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, VER_NUM verNum
    FROM ORD_EXT_ACCT
    WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
      AND  ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT} 
      AND OPER_TYPE = 1000
</select>
  <select id="selectOrdPaymentPlan" resultType="java.util.Map" parameterType="map"  >
 SELECT 
  ARCH_GRP_ID, ORDER_ITEM_ID, PAYMENT_PLAN_ID paymentPlanId, PAY_ACCT_TYPE payAcctType, PAY_ACCT_ID payAcctId, ACCT_ID acctId, 
    PAYMENT_METHOD paymentMethod, PRIORITY priority, PAYMENT_LIMIT_TYPE paymentLimitType, PAYMENT_LIMIT paymentLimit, UPPER_AMOUNT upperAmount, ROW_ID rowId, 
    OLD_ROW_ID oldRowId, OPER_TYPE operType, STATUS_CD statusCd, STATUS_DATE statusDate, EFF_DATE effDate, EXP_DATE expDate, CREATE_STAFF createStaff, 
    CREATE_DATE createDate, UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, VER_NUM verNum
  FROM ORD_PAYMENT_PLAN
  WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
      AND  ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT} 
      AND OPER_TYPE=1000
</select>

<select id="selectOrdAccount" resultType="java.util.Map" parameterType="map"  >
  select 
 ARCH_GRP_ID, ORDER_ITEM_ID, ACCT_ID acctId, ACCT_NAME acctName, ACCT_CD acctCd, CUST_ID custId, ACCT_LOGIN_NAME acctLoginName, 
    LOGIN_PASSWORD loginPassword, ACCT_BILLING_TYPE acctBillingType, ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType, STATUS_CD statusCd, STATUS_DATE statusDate, 
    EFF_DATE effDate, EXP_DATE expDate, CREATE_STAFF createStaff, CREATE_DATE createDate, UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark, 
    VER_NUM verNum, EXT_ACCT_ID extAcctId, PROD_INST_ID prodInstId, CUST_NAME custName, ACC_NUM accNum, OUTER_ACCT_ID outerAcctId,  GROUP_ACCT_ID groupAcctId
	FROM ORD_ACCOUNT
	WHERE  ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
      AND  ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT} 
      AND OPER_TYPE=1000
</select>

  <select id="selectOrdTaxPayerAttr" resultType="java.util.Map" parameterType="map"  >
     select 
     ARCH_GRP_ID  , ORDER_ITEM_ID , TAX_PAYER_ATTR_ID taxPayerAttrId, TAX_PAYER_ID taxPayerId, ATTR_ID attrId, ATTR_VALUE attrValue, 
    STATUS_CD statusCd, STATUS_DATE statusDate, UPDATE_STAFF updateStaff, CREATE_DATE createDate, UPDATE_DATE updateDate, CREATE_STAFF createStaff, ROW_ID rowId, 
    OLD_ROW_ID oldRowId, OPER_TYPE operType, REMARK remark, VER_NUM verNum, ATTR_VALUE_ID attrValueId
    from ord_tax_payer_attr
    where ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT} 
      AND  ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT} 
      
      <if test="operType != null">
      AND  OPER_TYPE = #{operType,jdbcType=BIGINT} 
      </if>
      <if test="taxPayerAttrId != null">
      AND  TAX_PAYER_ATTR_ID = #{taxPayerAttrId,jdbcType=BIGINT} 
    </if>
 </select> 
 
 <select id="selectOrdTaxPayer" resultType="java.util.Map" parameterType="map"  >
    select
    TAX_PAYER_ID taxPayerId,TAX_ID taxId,TAX_NAME taxName,TAX_PROVINCE_CODE taxProvinceCode, STATUS_CD statusCd,
	TAX_RELA_TEL taxRelaTel,TAX_RELA_ADDR taxRelaAddr,TAX_BANK_NAME taxBankName,
	TAX_BANK_ACCT taxBankAcct,START_DATE startDate,TAX_END_DATE taxEndDate,
	GENERAL_TAXPAYER_FLAG generalTaxpayerFlag,VAT_INVOICES_FLAG vatInvoicesFlag,BILL_DELIVER_WAY billDeliverWay,
	BILL_DELIVER_ADDR billDeliverAddr,EFF_DATE effDate,EXP_DATE expDate,OPER_TYPE operType
	FROM ORD_TAX_PAYER
    where ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT}
      AND  ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT} 
     <if test="operType != null">
      AND  OPER_TYPE = 1000
    </if>
     
  </select>
 
 <select id="selectOrdCustomer" resultType="java.util.Map" parameterType="map"  >
	 select ARCH_GRP_ID archGrpId, ORDER_ITEM_ID orderItemId, CUST_ID custId, TAX_PAYER_ID taxPayerId , PARTY_ID partyId, CUST_NAME custName, 
	CUST_NUMBER custNumber, CUST_ADDR custAddr, REGION_ID regionId, CUST_TYPE custType, CUST_SUB_TYPE custSubType, CUST_SOURCE_ID custSourceId, 
	CUST_AREA_GRADE custAreaGrade , ENTER_DATE enterDate, CUST_STATUS_CD custStatusCd, CUST_STATUS_DATE custStatusDate, EXT_CUST_ID extCustId, 
	DISTRIBUTOR_ID distributorId, SECRECY_LEV secrecyLev, CUST_ORDER_ID custOrderId, CUST_CONTROL_LEVEL custControlLevel, 
	IS_INSTEAD isInstead, IS_REALNAME isRealname, ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType, 
	STATUS_CD statusCd, STATUS_DATE statusDate, CREATE_STAFF createStaff, CREATE_DATE createDate, UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark,
	RECORD_STATUS_CD recordStatusCd, VER_NUM verNum, INDUSTRY_TYPE_ID industryTypeId, INDUSTRY_TYPE_NAME industryTypeName, OUTER_CUST_ID outerCustId, EXT1_CUST_ID ext1CustId, 
	EXT2_CUST_ID ext2CustId, EXT3_CUST_ID ext3CustId, GROUP_CUST_ID groupCustId, EXT_PARTY_ID extPartyId
	from ord_customer 
	where ARCH_GRP_ID =#{ARCH_GRP_ID,jdbcType=BIGINT} 
		  and ORDER_ITEM_ID =#{ORDER_ITEM_ID,jdbcType=BIGINT} 
		  and oper_type=1000
   </select>
 <!-- add by wangbaoqiang 添加当  oper_type !=1000时，取1300的情况 -->
    <select id="selectOrdCustomer_1300" resultType="java.util.Map" parameterType="map"  >
	 select ARCH_GRP_ID archGrpId, ORDER_ITEM_ID orderItemId, CUST_ID custId, TAX_PAYER_ID taxPayerId , PARTY_ID partyId, CUST_NAME custName, 
	CUST_NUMBER custNumber, CUST_ADDR custAddr, REGION_ID regionId, CUST_TYPE custType, CUST_SUB_TYPE custSubType, CUST_SOURCE_ID custSourceId, 
	CUST_AREA_GRADE custAreaGrade , ENTER_DATE enterDate, CUST_STATUS_CD custStatusCd, CUST_STATUS_DATE custStatusDate, EXT_CUST_ID extCustId, 
	DISTRIBUTOR_ID distributorId, SECRECY_LEV secrecyLev, CUST_ORDER_ID custOrderId, CUST_CONTROL_LEVEL custControlLevel, 
	IS_INSTEAD isInstead, IS_REALNAME isRealname, ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType, 
	STATUS_CD statusCd, STATUS_DATE statusDate, CREATE_STAFF createStaff, CREATE_DATE createDate, UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark,
	RECORD_STATUS_CD recordStatusCd, VER_NUM verNum, INDUSTRY_TYPE_ID industryTypeId, INDUSTRY_TYPE_NAME industryTypeName, OUTER_CUST_ID outerCustId, EXT1_CUST_ID, 
	EXT2_CUST_ID, EXT3_CUST_ID, GROUP_CUST_ID groupCustId, EXT_PARTY_ID extPartyId
	from ord_customer 
	where ARCH_GRP_ID =#{ARCH_GRP_ID,jdbcType=BIGINT} 
		  and ORDER_ITEM_ID =#{ORDER_ITEM_ID,jdbcType=BIGINT} 
		  and oper_type=1300
   </select>
  <!-- add end  --> 
   <select id="selectOrdBillObj" resultType="java.util.Map" parameterType="java.lang.Long"  >
    select
    ARCH_GRP_ID, SEQ_NO, ORDER_ITEM_ID, SERVICE_OFFER_ID, OBJ_ID, TABLE_NAME, CREATE_DATE, 
    SERVICE_OFFER_NAME, OBJ_SPEC, OBJ_SPEC_NAME
    from ord_bill_obj
     WHERE TABLE_NAME IN ('ORD_PARTY', 'ORD_CUSTOMER','ORD_TAX_PAYER', 'ORD_ACCOUNT', 'ORD_PROD_INST', 'ORD_PROD_INST_ACCT_REL','ORD_OFFER_INST')
     AND ARCH_GRP_ID = #{archGrpId,jdbcType=BIGINT}
     /*AND STATUS_CD = 'N'*/
     ORDER BY SEQ_NO
  </select>

  <select id="selectOrdBill" resultType="java.util.Map" parameterType="map" >
    select
     ARCH_GRP_ID, CUST_ORDER_ID, REGION_ID regionId, CREATE_ORG_ID, CREATE_STAFF, CREATE_DATE, 
    FINISH_DATE, PROC_FLAG, PROC_DATE, PROC_CNT, NOTES,CUST_ID
    from ord_bill  
    where 
    <choose>
		<when test="proc_flag != null and  proc_flag !='' ">
			PROC_FLAG = #{proc_flag}
		</when>
		<otherwise>
            PROC_FLAG = '0'
		</otherwise>
	</choose>
    <if test="mod != null and  mod !='' " >       
        and MOD(CUST_ID, #{mod}) = #{modValue}
    </if>
      <choose>
          <when test="regionFlag=='in'">
              and SUBSTR(REGION_ID,1,5) in (${regionId})
          </when>
          <when test="regionFlag =='notin'">
              and SUBSTR(REGION_ID,1,5) not in (${regionId})
          </when>
          <when test="regionId != null and regionId !='' ">
              and SUBSTR(REGION_ID,1,5) = #{regionId}
          </when>
      </choose>
      <!-- and ARCH_GRP_ID = '310012937730' -->
      <choose>
          <when test="proc_flag =='2'.toString()">
              and notes not like '%PRODACCT_ERROR_013%'
              and IFNULL(PROC_CNT,0) &lt; 200 ORDER BY FINISH_DATE, ARCH_GRP_ID  limit 0, 5000
          </when>
          <otherwise>
              and IFNULL(PROC_CNT,0) &lt; 200 ORDER BY FINISH_DATE, ARCH_GRP_ID limit 0, 1000
          </otherwise>
      </choose>

  </select>
  <select id="selectOrdBillCustId" resultType="java.util.Map" parameterType="java.lang.Long" >
    select
     ARCH_GRP_ID, CUST_ORDER_ID, REGION_ID regionId, CREATE_ORG_ID, CREATE_STAFF, CREATE_DATE, 
    FINISH_DATE, PROC_FLAG, PROC_DATE, PROC_CNT, NOTES,CUST_ID custId
    from ord_bill  
    where 
	ARCH_GRP_ID =#{ARCH_GRP_ID,jdbcType=BIGINT}
  </select>
  <update id="updateOrdBill" parameterType="map" >
    update ord_bill
    <set >
      <if test="procFlag != null" >
        PROC_FLAG = #{procFlag,jdbcType=VARCHAR},
      </if>
<!--       <if test="procCnt != null" >
        PROC_CNT = #{procCnt,jdbcType=BIGINT}
      </if> -->
     	PROC_CNT = IFNULL(PROC_CNT,0)+1,
      <if test="notes != null" >
        NOTES = #{notes,jdbcType=VARCHAR},
      </if>
      <if test="procDate != null" >
        proc_date = #{procDate,jdbcType=DATE},
      </if>
    </set>
    where ARCH_GRP_ID = #{archGrpId,jdbcType=BIGINT}
  </update>
  
 	<select id="queryOrdBill" resultType="map">
		select a.* from ord_bill a where a.create_date between #{bDate} and #{eDate} 
	</select>
	
	 <select id="queryOrdBillExpDate" resultType="java.util.Map" parameterType="map">
		select FINISH_DATE finishDate from ord_bill a where a.ARCH_GRP_ID = #{ARCH_GRP_ID ,jdbcType=BIGINT}
	</select>
	
<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!参与人相关F_INSERT_PARTY开始!!!!!!!!!!!!!!!!!!!!!!!!!!! -->	
<select id="getOrdParty" resultType="java.util.Map" parameterType="map"  >
SELECT 	ARCH_GRP_ID archGrpId,ORDER_ITEM_ID orderItemId,PARTY_ID partyId,PARTY_NAME partyName,PARTY_ABBRNAME partyAbbrname,
ENGLISH_NAME englishName,PARTY_TYPE partyType,ROW_ID rowId,OLD_ROW_ID oldRowId,OPER_TYPE operType,STATUS_CD statusCd,
STATUS_DATE statusDate,CREATE_STAFF createStaff,CREATE_DATE createDate,UPDATE_STAFF updateStaff,UPDATE_DATE updateDate,
REMARK remark,VER_NUM verNum,EXT_PARTY_ID extPartyId
	FROM ord_party 
	WHERE 1=1 
	<if test="arch_grp_id != null" >
	  and     ARCH_GRP_ID=#{arch_grp_id,jdbcType=BIGINT} 
	</if>
	<if test="order_item_id != null" >
	  and     ORDER_ITEM_ID=#{order_item_id,jdbcType=BIGINT} 
	</if>
	<if test="oper_type != null" >
	  and     OPER_TYPE=#{oper_type,jdbcType=VARCHAR} 
	</if>
</select>

<select id="getOrdPartyInd" resultType="java.util.Map" parameterType="map"  >
SELECT ARCH_GRP_ID archGrpId,INDIVIDUAL_ID individualId,PARTY_ID partyId,BIRTHDAY birthday,MARITAL_STATUS maritalStatus,
GENDER gender,NATIONALITY nationality,NATION nation,RELIGION religion,EDUCATION education,OCCUPATION occupation,
EMPLOYER employer,POSITION POSITION,WEBSITE website,ROW_ID rowId,ORDER_ITEM_ID orderItemId,OLD_ROW_ID oldRowId,
OPER_TYPE operType,STATUS_CD statusCd,STATUS_DATE statusDate,CREATE_STAFF createStaff,CREATE_DATE createDate,
UPDATE_STAFF updateStaff,UPDATE_DATE updateDate,REMARK remark,VER_NUM verNum 
	FROM ord_party_ind
	WHERE 1=1 
	<if test="arch_grp_id != null" >
	  and     ARCH_GRP_ID=#{arch_grp_id,jdbcType=BIGINT} 
	</if>
	<if test="order_item_id != null" >
	  and     ORDER_ITEM_ID=#{order_item_id,jdbcType=BIGINT} 
	</if>
	<if test="oper_type != null" >
	  and     OPER_TYPE=#{oper_type,jdbcType=VARCHAR} 
	</if>
</select> 
<select id="getCountOrdPartyInd" resultType="java.lang.Integer" parameterType="map"  >
      SELECT COUNT(1) 
        FROM ORD_PARTY_IND
       WHERE ORDER_ITEM_ID = #{order_item_id,jdbcType=BIGINT}
         AND ARCH_GRP_ID = #{arch_grp_id,jdbcType=BIGINT}
</select>
<select id="getOrdPartyRole" resultType="java.util.Map" parameterType="map"  >
SELECT ARCH_GRP_ID archGrpId,PARTY_ROLE_ID partyRoleId,PARTY_ID partyId,ROLE_TYPE roleType,ROW_ID rowId,
ORDER_ITEM_ID orderItemId,OLD_ROW_ID oldRowId,OPER_TYPE operType,STATUS_CD statusCd,STATUS_DATE statusDate,
CREATE_STAFF createStaff,CREATE_DATE createDate,UPDATE_STAFF updateStaff,UPDATE_DATE updateDate,REMARK remark,VER_NUM verNum 
	FROM ord_party_role
	WHERE 1=1 
	<if test="arch_grp_id != null" >
	  and     ARCH_GRP_ID=#{arch_grp_id,jdbcType=BIGINT} 
	</if>
	<if test="order_item_id != null" >
	  and     ORDER_ITEM_ID=#{order_item_id,jdbcType=BIGINT} 
	</if>
	<if test="oper_type != null" >
	  and     OPER_TYPE=#{oper_type,jdbcType=VARCHAR} 
	</if>
</select>	
<select id="getCountOrdPartyRole" resultType="java.lang.Integer" parameterType="map"  >
      SELECT COUNT(1) 
        FROM ORD_PARTY_ROLE
       WHERE ORDER_ITEM_ID = #{order_item_id,jdbcType=BIGINT}
         AND ARCH_GRP_ID = #{arch_grp_id,jdbcType=BIGINT}
         AND PARTY_ROLE_ID = #{party_role_id,jdbcType=BIGINT} 
</select>
<select id="getOrdPartyAttr" resultType="java.util.Map" parameterType="map"  >
SELECT ARCH_GRP_ID archGrpId,ORDER_ITEM_ID orderItemId,PARTY_ATTR_ID partyAttrId,PARTY_ID partyId,ATTR_ID attrId,
ATTR_VALUE attrValue,ROW_ID rowId,OLD_ROW_ID oldRowId,OPER_TYPE operType,STATUS_CD statusCd,STATUS_DATE statusDate,
CREATE_STAFF createStaff,CREATE_DATE createDate,UPDATE_STAFF updateStaff,UPDATE_DATE updateDate,REMARK remark,VER_NUM verNum,
ATTR_VALUE_ID attrValueId
	FROM ORD_PARTY_ATTR
	WHERE 1=1 
	<if test="arch_grp_id != null" >
	  and     ARCH_GRP_ID=#{arch_grp_id,jdbcType=BIGINT} 
	</if>
	<if test="order_item_id != null" >
	  and     ORDER_ITEM_ID=#{order_item_id,jdbcType=BIGINT} 
	</if>
	<if test="oper_type != null" >
	  and     OPER_TYPE=#{oper_type,jdbcType=VARCHAR} 
	</if>
</select> 
<select id="getCountOrdPartyAttr" resultType="java.lang.Integer" parameterType="map"  >
      SELECT COUNT(1) 
        FROM ORD_PARTY_ATTR
       WHERE ORDER_ITEM_ID = #{order_item_id,jdbcType=BIGINT}
         AND ARCH_GRP_ID = #{arch_grp_id,jdbcType=BIGINT}
         AND PARTY_ATTR_ID = #{party_attr_id,jdbcType=BIGINT}
</select>
 <select id="getOrdContactsInfo" resultType="java.util.Map" parameterType="map"  >
SELECT ARCH_GRP_ID archGrpId,ORDER_ITEM_ID orderItemId,CONTACT_ID contactId,PARTY_ID partyId,CONTACT_TYPE contactType,
CONTACT_NAME contactName,CONTACT_GENDER contactGender,CONTACT_ADDR contactAddr,CONTACT_EMPLOYER contactEmployer,
HOME_PHONE homePhone,OFFICE_PHONE officePhone,MOBILE_PHONE mobilePhone,CONTACT_DESC contactDesc,E_MAIL eMail,
POSTCODE postcode,POST_ADDR postAddr,FAX fax,ROW_ID rowId,OLD_ROW_ID oldRowId,OPER_TYPE operType,STATUS_CD statusCd,
STATUS_DATE statusDate,CREATE_STAFF createStaff,CREATE_DATE createDate,UPDATE_STAFF updateStaff,UPDATE_DATE updateDate,
REMARK remark,VER_NUM verNum,UNSUITABLE_CONTACT_TIME unsuitableContactTime,YX_CODE yxCode,QQ_CODE qqCode,WX_CODE wxCode 
	FROM ord_contacts_info
	WHERE 1=1 
	<if test="arch_grp_id != null" >
	  and     ARCH_GRP_ID=#{arch_grp_id,jdbcType=BIGINT} 
	</if>
	<if test="order_item_id != null" >
	  and     ORDER_ITEM_ID=#{order_item_id,jdbcType=BIGINT} 
	</if>
	<if test="oper_type != null" >
	  and     OPER_TYPE=#{oper_type,jdbcType=VARCHAR} 
	</if>
</select> 
<select id="getCountOrdContactsInfo" resultType="java.lang.Integer" parameterType="map"  >
      SELECT COUNT(1) 
        FROM ord_contacts_info
       WHERE ORDER_ITEM_ID = #{order_item_id,jdbcType=BIGINT}
         AND ARCH_GRP_ID = #{arch_grp_id,jdbcType=BIGINT}
         AND CONTACT_ID = #{contact_id,jdbcType=BIGINT}
</select>  
<select id="getOrdContactsInfoAttr" resultType="java.util.Map" parameterType="map"  >
SELECT ARCH_GRP_ID archGrpId,ORDER_ITEM_ID orderItemId,CONNECT_ATTR_ID connectAttrId,CONTACT_ID contactId,ATTR_ID attrId,
ATTR_VALUE attrValue,ROW_ID rowId,OLD_ROW_ID oldRowId,OPER_TYPE operType,STATUS_CD statusCd,STATUS_DATE statusDate,
CREATE_STAFF createStaff,CREATE_DATE createDate,UPDATE_STAFF updateStaff,UPDATE_DATE updateDate,REMARK remark,VER_NUM verNum,
ATTR_VALUE_ID attrValueId 
	FROM ord_contacts_info_attr
	WHERE 1=1 
	<if test="arch_grp_id != null" >
	  and     ARCH_GRP_ID=#{arch_grp_id,jdbcType=BIGINT} 
	</if>
	<if test="order_item_id != null" >
	  and     ORDER_ITEM_ID=#{order_item_id,jdbcType=BIGINT} 
	</if>
	<if test="oper_type != null" >
	  and     OPER_TYPE=#{oper_type,jdbcType=VARCHAR} 
	</if>
</select> 
<select id="getCountOrdContactsInfoAttr" resultType="java.lang.Integer" parameterType="map"  >
      SELECT COUNT(1) 
        FROM ord_contacts_info_attr
       WHERE ORDER_ITEM_ID = #{order_item_id,jdbcType=BIGINT}
         AND ARCH_GRP_ID = #{arch_grp_id,jdbcType=BIGINT}
         AND CONNECT_ATTR_ID = #{connect_attr_id,jdbcType=BIGINT}
</select>
 <!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!客户相关F_INSERT_CUSTOMER开始!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
<select id="getOrdCustContactInfoRel" resultType="java.util.Map" parameterType="map"  >
SELECT ARCH_GRP_ID archGrpId,ORDER_ITEM_ID orderItemId,CUST_CONNECT_ID custConnectId,CUST_ID custId,CONTACT_ID contactId,
HEAD_FLAG headFlag,ROW_ID rowId,OLD_ROW_ID oldRowId,OPER_TYPE operType,STATUS_CD statusCd,STATUS_DATE statusDate,
CREATE_STAFF createStaff,CREATE_DATE createDate,UPDATE_STAFF updateStaff,UPDATE_DATE updateDate,REMARK remark,VER_NUM verNum
	FROM ord_cust_contact_info_rel
	WHERE 1=1 
	<if test="arch_grp_id != null" >
	  and     ARCH_GRP_ID=#{arch_grp_id,jdbcType=BIGINT} 
	</if>
	<if test="order_item_id != null" >
	  and     ORDER_ITEM_ID=#{order_item_id,jdbcType=BIGINT} 
	</if>
	<if test="oper_type != null" >
	  and     OPER_TYPE=#{oper_type,jdbcType=VARCHAR} 
	</if>
</select> 

<select id="getCountOrdCustContactInfoRel" resultType="java.lang.Integer" parameterType="map"  >
      SELECT COUNT(1) 
        FROM ord_cust_contact_info_rel
       WHERE ORDER_ITEM_ID = #{order_item_id,jdbcType=BIGINT}
         AND ARCH_GRP_ID = #{arch_grp_id,jdbcType=BIGINT}
         AND CUST_CONNECT_ID = #{cust_connect_id,jdbcType=BIGINT}
</select>
<select id="getOrdPartyCert" resultType="java.util.Map" parameterType="map"  >
SELECT ARCH_GRP_ID archGrpId,PARTY_CERT_ID partyCertId,PARTY_ID partyId,CERT_TYPE certType,CERT_ORG certOrg,CERT_ADDR certAddr,
CERT_NUM certNum,CHECKER checker,CHECK_TIME checkTime,CERT_CHECK_RESULT certCheckResult,EFF_DATE effDate,EXP_DATE expDate,
ROW_ID rowId,ORDER_ITEM_ID orderItemId,OLD_ROW_ID oldRowId,OPER_TYPE operType,STATUS_CD statusCd,STATUS_DATE statusDate,
CREATE_STAFF createStaff,CREATE_DATE createDate,UPDATE_STAFF updateStaff,UPDATE_DATE updateDate,REMARK remark,VER_NUM verNum,
IS_REALNAME_CERT isRealnameCert
	FROM ord_party_cert
	WHERE 1=1 
	<if test="arch_grp_id != null" >
	  and     ARCH_GRP_ID=#{arch_grp_id,jdbcType=BIGINT} 
	</if>
	<if test="order_item_id != null" >
	  and     ORDER_ITEM_ID=#{order_item_id,jdbcType=BIGINT} 
	</if>
	<if test="oper_type != null" >
	  and     OPER_TYPE=#{oper_type,jdbcType=VARCHAR} 
	</if>
</select> 

<select id="getCountOrdPartyCert" resultType="java.lang.Integer" parameterType="map"  >
      SELECT COUNT(1) 
        FROM ord_party_cert
       WHERE ORDER_ITEM_ID = #{order_item_id,jdbcType=BIGINT}
         AND ARCH_GRP_ID = #{arch_grp_id,jdbcType=BIGINT}
         AND PARTY_CERT_ID = #{party_cert_id,jdbcType=BIGINT}
</select>  
<select id="getOrdCustAttr" resultType="java.util.Map" parameterType="map"  >
SELECT ARCH_GRP_ID archGrpId,CUST_ATTR_ID custAttrId,CUST_ID custId,ATTR_ID attrId,ATTR_VALUE_ID attrValueId,
ATTR_VALUE attrValue,ROW_ID rowId,ORDER_ITEM_ID orderItemId,OLD_ROW_ID oldRowId,OPER_TYPE operType,STATUS_CD statusCd,
STATUS_DATE statusDate,CREATE_STAFF createStaff,CREATE_DATE createDate,UPDATE_STAFF updateStaff,UPDATE_DATE updateDate,
REMARK remark,VER_NUM verNum 
	FROM ord_cust_attr
	WHERE 1=1 
	<if test="arch_grp_id != null" >
	  and     ARCH_GRP_ID=#{arch_grp_id,jdbcType=BIGINT} 
	</if>
	<if test="order_item_id != null" >
	  and     ORDER_ITEM_ID=#{order_item_id,jdbcType=BIGINT} 
	</if>
</select>
<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!一般纳税相关F_INSERT_TAXPAYER开始!!!!!!!!!!!!!!!!!!!!!!!!!!! -->   
<select id="getOrdTaxPayer" resultType="java.util.Map" parameterType="map"  >
SELECT ARCH_GRP_ID archGrpId,ORDER_ITEM_ID orderItemId,TAX_PAYER_ID taxPayerId,TAX_ID taxId,TAX_NAME taxName,
TAX_RELA_TEL taxRelaTel,TAX_RELA_ADDR taxRelaAddr,TAX_BANK_NAME taxBankName,TAX_BANK_ACCT taxBankAcct,START_DATE startDate,
TAX_END_DATE taxEndDate,GENERAL_TAXPAYER_FLAG generalTaxpayerFlag,VAT_INVOICES_FLAG vatInvoicesFlag,BILL_DELIVER_WAY billDeliverWay,
BILL_DELIVER_ADDR billDeliverAddr,EFF_DATE effDate,EXP_DATE expDate,STATUS_CD statusCd,STATUS_DATE statusDate,
UPDATE_STAFF updateStaff,CREATE_DATE createDate,UPDATE_DATE updateDate,CREATE_STAFF createStaff,ROW_ID rowId,OPER_TYPE operType,
REMARK remark,VER_NUM verNum,TAX_PROVINCE_CODE taxProvinceCode,APPROVAL_TIME approvalTime,POST_CODE postCode
	FROM ord_tax_payer
	WHERE 1=1 
	<if test="arch_grp_id != null" >
	  and     ARCH_GRP_ID=#{arch_grp_id,jdbcType=BIGINT} 
	</if>
	<if test="order_item_id != null" >
	  and     ORDER_ITEM_ID=#{order_item_id,jdbcType=BIGINT} 
	</if>
	<if test="oper_type != null" >
	  and     OPER_TYPE=#{oper_type,jdbcType=VARCHAR} 
	</if>
</select>
<select id="getCountOrdTaxPayer" resultType="java.lang.Integer" parameterType="map"  >
      SELECT COUNT(1) 
        FROM ord_tax_payer
       WHERE ORDER_ITEM_ID = #{order_item_id,jdbcType=BIGINT}
         AND ARCH_GRP_ID = #{arch_grp_id,jdbcType=BIGINT}
</select>
<select id="getOrdTaxPayerAttr" resultType="java.util.Map" parameterType="map"  >
SELECT ARCH_GRP_ID archGrpId,ORDER_ITEM_ID orderItemId,TAX_PAYER_ATTR_ID taxPayerAttrId,TAX_PAYER_ID taxPayerId,ATTR_ID attrId,
ATTR_VALUE attrValue,STATUS_CD statusCd,STATUS_DATE statusDate,UPDATE_STAFF updateStaff,CREATE_DATE createDate,
UPDATE_DATE updateDate,CREATE_STAFF createStaff,ROW_ID rowId,OLD_ROW_ID oldRowId,OPER_TYPE operType,REMARK remark,
VER_NUM verNum,ATTR_VALUE_ID attrValueId
	FROM ord_tax_payer_attr
	WHERE 1=1 
	<if test="arch_grp_id != null" >
	  and     ARCH_GRP_ID=#{arch_grp_id,jdbcType=BIGINT} 
	</if>
	<if test="order_item_id != null" >
	  and     ORDER_ITEM_ID=#{order_item_id,jdbcType=BIGINT} 
	</if>
	<if test="oper_type != null" >
	  and     OPER_TYPE=#{oper_type,jdbcType=VARCHAR} 
	</if>
</select>
<select id="getCountOrdTaxPayerAttr" resultType="java.lang.Integer" parameterType="map"  >
      SELECT COUNT(1) 
        FROM ord_tax_payer_attr
       WHERE ORDER_ITEM_ID = #{order_item_id,jdbcType=BIGINT}
         AND ARCH_GRP_ID = #{arch_grp_id,jdbcType=BIGINT}
         AND TAX_PAYER_ATTR_ID = #{tax_payer_attr_id,jdbcType=BIGINT}
</select>

<select id="getOrdProdInstAcctRelAttr" resultType="java.util.Map" parameterType="map"  >
      select
      ROW_ID , ARCH_GRP_ID, ORDER_ITEM_ID, PROD_INST_ACCT_REL_ATTR_ID, PROD_INST_ACCT_REL_ID,
    ATTR_ID, ATTR_VALUE_ID, ATTR_VALUE, ATTR_NAME, OLD_ROW_ID, OPER_TYPE, EFF_DATE, EXP_DATE,
    STATUS_CD, STATUS_DATE, CREATE_STAFF, CREATE_DATE, UPDATE_STAFF, UPDATE_DATE, VER_NUM
      from ORD_PROD_INST_ACCT_REL_ATTR
      where OPER_TYPE = #{operType}
      and ARCH_GRP_ID=#{ARCH_GRP_ID}
      and ORDER_ITEM_ID=#{ORDER_ITEM_ID}
</select>

<select id="getOperFlag" resultType="java.lang.Long" parameterType="map"  >
      select count(*)
      from ORD_PROD_INST
      where PROD_USE_TYPE = 2000
      and OPER_TYPE = 1100
      and ARCH_GRP_ID=#{ARCH_GRP_ID}
      and PROD_ID = #{prodId}
      and ORDER_ITEM_ID=#{ORDER_ITEM_ID}
</select>
    <select id="getCntOrdBillObj" resultType="java.lang.Long" parameterType="map"  >
      select count(1)
      from ord_bill_obj
      where  ARCH_GRP_ID=#{ARCH_GRP_ID}
      and STATUS_CD='N'
</select>
  <select id="getAccount" resultType="java.util.Map" parameterType="map" >
  	 select 
 	ARCH_GRP_ID, ORDER_ITEM_ID, ACCT_ID acctId, ACCT_NAME acctName, ACCT_CD acctCd, CUST_ID custId, ACCT_LOGIN_NAME acctLoginName, 
    LOGIN_PASSWORD loginPassword, ACCT_BILLING_TYPE acctBillingType, ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType, STATUS_CD statusCd, STATUS_DATE statusDate, 
    EFF_DATE effDate, EXP_DATE expDate, CREATE_STAFF createStaff, CREATE_DATE createDate, UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark, 
    VER_NUM verNum, EXT_ACCT_ID extAcctId, PROD_INST_ID prodInstId, CUST_NAME custName, ACC_NUM accNum, OUTER_ACCT_ID outerAcctId,  GROUP_ACCT_ID groupAcctId
	FROM ORD_ACCOUNT
     WHERE  PROD_INST_ID=#{prodInstId}
  </select>
  <!-- add by wangbaoqiang begin -->
  <insert id="insertTrunkbill"  parameterType="map" >
    insert into b_trunk_billing
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="switchId != null" >
        SWITCH_ID,
      </if>
      <if test="trunkCode != null" >
        TRUNK_CODE,
      </if>
      <if test="trunkSide != null" >
        TRUNK_SIDE,
      </if>
      <if test="accNbr != null" >
        ACC_NBR,
      </if>
      <if test="effDate != null" >
        EFF_DATE,
      </if>
      <if test="expDate != null" >
        EXP_DATE,
      </if>
      <if test="remark != null" >
        REMARK,
      </if>
      <if test="gatherPot != null" >
        GATHER_POT,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="switchId != null" >
        #{switchId,jdbcType=BIGINT},
      </if>
      <if test="trunkCode != null" >
        #{trunkCode,jdbcType=VARCHAR},
      </if>
      <if test="trunkSide != null" >
        #{trunkSide,jdbcType=CHAR},
      </if>
      <if test="accNbr != null" >
        #{accNbr,jdbcType=VARCHAR},
      </if>
      <if test="effDate != null" >
        #{effDate,jdbcType=DATE},
      </if>
      <if test="expDate != null" >
        #{expDate,jdbcType=DATE},
      </if>
      <if test="remark != null" >
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="gatherPot != null" >
        #{gatherPot,jdbcType=BIGINT},
      </if>
    </trim>
  </insert>
    <select id="selectTifProdContrast" resultType="java.util.Map" parameterType="map" >
    select 
    PROD_ID_97 prodId97, PROD_NAME_97 prodName97, PROD_ID_BILL prodIdBill, PROD_NAME_BILL prodNameBill, PROD_TYPE prodType, ORG_GET_MODE, 
    DESCRIPTION
    from tif_prod_contrast
    where PROD_ID_97 = #{prodId,jdbcType=VARCHAR}
  </select>
  <select id="selectTifOrgContrast" resultType="java.util.Map" parameterType="map" >
  	 select 
 	common_region_id commonRegionId, area_code areaCode, bureau_no_97, bureau_name_97, org_id_bill orgIdBill, org_name_bill,
    description, trunk_id_bill trunkIdBill
    From tif_bureau_org_contrast
     WHERE  COMMON_REGION_ID=#{regionId,jdbcType=BIGINT}
  </select>
  <select id="selectTifProdAttribContrast" resultType="java.util.Map" parameterType="java.lang.String" >
    select 
    PROD_ID_97, ATTRIB_ID_97, ATTRIB_VALUE_97, ATTRIB_NAME_97, ALLOW_FLAG, ATTRIB_ID_BILL, 
    ATTRIB_VALUE_BILL, ATTRIB_NAME_BILL, DESCRIPTION, IS_RENT
    from tif_prod_attrib_contrast
    where 
     ATTRIB_ID_97 = #{attrId,jdbcType=VARCHAR}
     AND ALLOW_FLAG != 'X'
  </select>
  <select id="selectTifSubProdContrast" resultType="java.util.Map" parameterType="java.lang.String" >
    select 
    PROD_ID_97, PROD_NAME_97, PROD_ID_BILL, PROD_NAME_BILL, PROD_TYPE prodType, DESCRIPTION
    from tif_subprod_contrast
    where PROD_ID_97 = #{prodId,jdbcType=VARCHAR}
  </select>
	<!-- add end -->
    <select id="getOrdBillAndOrdBillProdInst" resultType="java.util.HashMap"  parameterType="map">
        select  A.ARCH_GRP_ID
        from ORD_BILL A ,ORD_BILL_PROD_INST B
        WHERE A.ARCH_GRP_ID = B.ARCH_GRP_ID
        AND B.PROD_INST_ID = #{prodInstId}
        AND  #{effDate} > A.FINISH_DATE
        AND PROC_FLAG IN ("0","2")
    </select>

    <select id="getOrdBill" resultType="java.util.Map" parameterType="map" >
        select
        ARCH_GRP_ID, CUST_ORDER_ID, REGION_ID, CREATE_ORG_ID, CREATE_STAFF, CREATE_DATE,
        FINISH_DATE, PROC_FLAG, PROC_DATE, PROC_CNT, NOTES,CUST_ID
        from ord_bill
        where ARCH_GRP_ID = ${ARCH_GRP_ID}
    </select>
    <select id="getOrdBillProdInst" resultType="java.util.HashMap" parameterType="map" >
  	 select PROD_INST_ID
  	 FROM ORD_BILL_PROD_INST
  	 where ARCH_GRP_ID = #{ARCH_GRP_ID}
  	 ORDER BY PROD_INST_ID
  </select>
<select id="selectCntOrdProdInstState" resultType="java.lang.Long" parameterType="map" >
    select 
    count(*)
    from ord_prod_inst_state
    where ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT}
    and ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT}
    and PROD_INST_ID = #{prodInstId,jdbcType=BIGINT}
  </select>
 <select id="selectOrdProdInstStateFor1000" resultType="java.util.Map" parameterType="map" >
    select 
    ROW_ID, ARCH_GRP_ID, ORDER_ITEM_ID, PROD_INST_STATE_ID, PROD_INST_ID, STOP_TYPE stopType, 
    EFF_DATE, EXP_DATE, STOP_DIRECTION, STOP_REASON, EVENT_DATE, OLD_ROW_ID, OPER_TYPE, 
    STATUS_CD, STATUS_DATE, CREATE_STAFF, CREATE_DATE, UPDATE_STAFF, UPDATE_DATE, REMARK, 
    VER_NUM
    from ord_prod_inst_state
    where ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT}
    and ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT}
    and PROD_INST_ID = #{prodInstId,jdbcType=BIGINT}
    and status_cd in (1000,1100)
    and oper_type = 1000
  </select>
  
  <select id="selectOrdProdInstStateFor1300" resultType="java.util.Map" parameterType="map" >
    select 
    ROW_ID, ARCH_GRP_ID, ORDER_ITEM_ID, PROD_INST_STATE_ID, PROD_INST_ID, STOP_TYPE stopType, 
    EFF_DATE, EXP_DATE, STOP_DIRECTION, STOP_REASON, EVENT_DATE, OLD_ROW_ID, OPER_TYPE, 
    STATUS_CD, STATUS_DATE, CREATE_STAFF, CREATE_DATE, UPDATE_STAFF, UPDATE_DATE, REMARK, 
    VER_NUM
    from ord_prod_inst_state
    where ORDER_ITEM_ID = #{ORDER_ITEM_ID,jdbcType=BIGINT}
    and ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT}
    and PROD_INST_ID = #{prodInstId,jdbcType=BIGINT}
    and status_cd in 1300
    and oper_type = 1000
  </select>
    <select id="selectOrdProdInst1100" resultType="java.util.Map"></select>
    <select id="selectOrdOfferProdInstRelForRole" resultType="java.util.Map" parameterType="map">
       SELECT
 ARCH_GRP_ID, ORDER_ITEM_ID, OFFER_PROD_INST_REL_ID offerProdInstRelId, OFFER_INST_ID offerInstId, PROD_INST_ID prodInstId,
    REL_TYPE relType, EFF_DATE effDate, EXP_DATE expDate, ROLE_ID roleId, ROW_ID rowId, OLD_ROW_ID oldRowId, OPER_TYPE operType, STATUS_CD statusCd,
    STATUS_DATE statusDate, CREATE_STAFF createStaff, CREATE_DATE createDate, UPDATE_STAFF updateStaff, UPDATE_DATE updateDate, REMARK remark, OFFER_PROD_REL_ID offerProdRelId,
    VER_NUM verNum, PROD_FUNC_TYPE prodFuncType, PROD_ID prodId, ACC_PROD_INST_ID accProdInstId, ACC_NUM accNum, ROLE_NAME roleName, PROD_NAME prodName,
    PROD_USE_TYPE prodUseType, PI_REGION_ID piRegionId
FROM ORD_OFFER_PROD_INST_REL
WHERE ARCH_GRP_ID = #{ARCH_GRP_ID,jdbcType=BIGINT}
     and OFFER_INST_ID = #{offerInstId,jdbcType=BIGINT}
     and ROLE_ID NOT IN (90000,402)
    </select>
    <select id="selectCrmRent" resultType="java.util.Map">
        SELECT
            ROW_ID, ARCH_GRP_ID, ORDER_ITEM_ID, OFFER_INST_ID offerInstId, PROD_INST_ID prodInstId, OFFER_TYPE offerType, OFFER_START_DATE offerStartDate,
            BILL_TOTAL_FEE billTotalFee, CRM_TOTAL_FEE crmTotalFee, END_TYPE endType, RENT_MONTH rentMonth, OFFER_ID offerId, RETURN_TYPE returnType, RETURN_RULE_ID returnRuleId,
            STATE state, STATUS_CD statusCd
        FROM crm_rent
        WHERE ARCH_GRP_ID = #{archGrpId}
        AND ORDER_ITEM_ID = #{orderItemId}
        <if test="offerInstId != 0" >
        AND OFFER_INST_ID = #{offerInstId}
        </if>
    </select>
    <select id="selectOneItemResult" resultType="java.util.Map">
        SELECT
 ARCH_GRP_ID, ONE_ACCT_ITEM_ID, CUST_ORDER_ID, ORDER_ITEM_ID, SOURCE_TYPE, BILL_ID,
    PAYMENT_ID, ACCT_ITEM_TYPE_ID, BILL_ACCT_ITEM_TYPE_ID, BALANCE_TYPE_ID, BILLING_CYCLE_ID,
    ITEM_SOURCE_ID, ACCT_ID, PROD_INST_ID, OFFER_INST_ID, OFFER_ID, REAL_AMOUNT, TAX_RATE_CONFIG_ID,
    TAX_RATE, TAX, PRICE, RESULT_ITEM_TYPE, CREATE_DATE, CHARGE_METHOD, STATUS_CD, STATUS_DATE,
    ORI_ACCT_ITEM_ID, LAN_ID, IF_CHARGE_OFF, MERGE_ACCT_DEAL_TIME, PAID_IN_AMOUNT, RECEIPT_ID,
    BUSI_NAME, EXT_ACCT_ITEM_ID, PROD_ID, STAFF_ID, ORG_ID, PROC_FLAG, REMARKS
 FROM ONE_ITEM_RESULT
 where ARCH_GRP_ID = #{archGrpId}
 AND ORDER_ITEM_ID = #{orderItemId}
    </select>
    <select id="getOneItemResultFromArchGrpId" resultType="java.util.Map">
       SELECT ARCH_GRP_ID archGrpId, ONE_ACCT_ITEM_ID oneAcctItemId, CUST_ORDER_ID custOrderId, ORDER_ITEM_ID orderItemId, SOURCE_TYPE sourceType, BILL_ID billId,
    PAYMENT_ID paymentId, ACCT_ITEM_TYPE_ID acctItemTypeId, BILL_ACCT_ITEM_TYPE_ID billAcctItemTypeId, BALANCE_TYPE_ID balanceTypeId, BILLING_CYCLE_ID billingCycleId,
    ITEM_SOURCE_ID itemSourceId, ACCT_ID acctId, PROD_INST_ID prodInstId, OFFER_INST_ID offerInstId, OFFER_ID offerId, REAL_AMOUNT realAmount, TAX_RATE_CONFIG_ID taxRateConfigId,
    TAX_RATE taxRate, TAX tax, PRICE price, RESULT_ITEM_TYPE resultItemType, CREATE_DATE createDate, CHARGE_METHOD chargeMethod, STATUS_CD statusCd, STATUS_DATE statusDate,
    ORI_ACCT_ITEM_ID oriAcctItemId, LAN_ID lanId, IF_CHARGE_OFF ifChargeOff, MERGE_ACCT_DEAL_TIME mergeAcctDealTime, PAID_IN_AMOUNT paidInAmount, RECEIPT_ID receiptId,
    BUSI_NAME busiName, EXT_ACCT_ITEM_ID extAcctItemId, PROD_ID prodId, STAFF_ID staffId, ORG_ID orgId, PROC_FLAG procFlag, REMARKS remarks
 FROM ONE_ITEM_RESULT
 WHERE ARCH_GRP_ID = #{archGrpId}
 and ORDER_ITEM_ID = #{orderItemId}
    </select>
    <select id="getOneItemResultHisFromArchGrpId" resultType="java.util.Map">
       SELECT ARCH_GRP_ID archGrpId, ONE_ACCT_ITEM_ID oneAcctItemId, CUST_ORDER_ID custOrderId, ORDER_ITEM_ID orderItemId, SOURCE_TYPE sourceType, BILL_ID billId,
    PAYMENT_ID paymentId, ACCT_ITEM_TYPE_ID acctItemTypeId, BILL_ACCT_ITEM_TYPE_ID billAcctItemTypeId, BALANCE_TYPE_ID balanceTypeId, BILLING_CYCLE_ID billingCycleId,
    ITEM_SOURCE_ID itemSourceId, ACCT_ID acctId, PROD_INST_ID prodInstId, OFFER_INST_ID offerInstId, OFFER_ID offerId, REAL_AMOUNT realAmount, TAX_RATE_CONFIG_ID taxRateConfigId,
    TAX_RATE taxRate, TAX tax, PRICE price, RESULT_ITEM_TYPE resultItemType, CREATE_DATE createDate, CHARGE_METHOD chargeMethod, STATUS_CD statusCd, STATUS_DATE statusDate,
    ORI_ACCT_ITEM_ID oriAcctItemId, LAN_ID lanId, IF_CHARGE_OFF ifChargeOff, MERGE_ACCT_DEAL_TIME mergeAcctDealTime, PAID_IN_AMOUNT paidInAmount, RECEIPT_ID receiptId,
    BUSI_NAME busiName, EXT_ACCT_ITEM_ID extAcctItemId, PROD_ID prodId, STAFF_ID staffId, ORG_ID orgId, PROC_FLAG procFlag, REMARKS remarks
 FROM one_item_result_his
 WHERE ARCH_GRP_ID = #{archGrpId}
 and ORDER_ITEM_ID = #{orderItemId}
    </select>
    <select id="selectTifObjectId" resultType="java.util.Map">
        select  DISCT_ID_97, DISCT_OBJECT_ID_97, DISCT_OBJECT_NAME_97, DISCT_OBJECT_ID_BILL, DISCT_OBJECT_NAME_BILL,
    DESCRIPTION
        from tif_disct_object_id_contrast
        where DISCT_ID_97 = #{offerId,jdbcType=BIGINT}
        and DISCT_OBJECT_ID_97 = #{roleId,jdbcType=VARCHAR}
    </select>
    <select id="selectServiceOfferContrast" resultType="java.util.Map">
        select
        SERVCIE_OFFER_ID servcieOfferId, SERVICE_OFFER_NAME serviceOfferName, STOP_TYPE  stopType, STATUS_CD statusCd, BILL_STATUS_CD billStatusCd, REMARK remark
        from service_offer_contrast
        where SERVCIE_OFFER_ID = #{servcieOfferId,jdbcType=VARCHAR}
    </select>

    <select id="selectOrdBillError" resultType="java.util.Map"  >
    select
     ARCH_GRP_ID, CUST_ORDER_ID, REGION_ID regionId, CREATE_ORG_ID, CREATE_STAFF, CREATE_DATE,
    FINISH_DATE, PROC_FLAG, PROC_DATE, PROC_CNT, NOTES,CUST_ID custId
    from ord_bill
    where
	NOTES like  CONCAT('%',#{errorNotes},'%')
	and proc_flag = 2
  </select>

    <select id="selectOrdBillProdInstAcctRel" resultType="java.util.Map"  >
    select
     count(1)
    from ORD_PROD_INST_ACCT_REL
    where
	ARCH_GRP_ID = #{archGrpId}
	and ACCT_ITEM_GROUP_ID = -1
  </select>
    <delete id="delOrdBillProdInstAcctRel" parameterType="java.lang.Long">
    delete from ORD_PROD_INST_ACCT_REL
    where
    ARCH_GRP_ID = #{archGrpId}
	and ACCT_ITEM_GROUP_ID = -1
  </delete>
    <select id="selectTifBreakDisct" resultType="java.util.Map"  >
    select
      DISCT_ID_BILL disctIdBill,DISCT_NAME disctName,BREAK_DISCT_ID breakDisctId
    from TIF_BREAK_DISCT_CONTRAST
    where
      DISCT_ID_BILL = #{offerId}
  </select>
</mapper>